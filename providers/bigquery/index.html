<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="transform data on the data warehouse (BigQuery) by writing Amora Models that describe the data schema using Python's PEP484 - Type Hints"><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.5.2, mkdocs-material-8.5.10"><title>BigQuery - Amora Data Build Tool</title><link rel=stylesheet href=../../assets/stylesheets/main.472b142f.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.08040f6c.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/_mkdocstrings.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#bigquery class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Amora Data Build Tool" class="md-header__button md-logo" aria-label="Amora Data Build Tool" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Amora Data Build Tool </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> BigQuery </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5M7 15a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=teal data-md-color-accent aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/mundipagg/amora-data-build-tool title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> amora-data-build-tool </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Amora Data Build Tool" class="md-nav__button md-logo" aria-label="Amora Data Build Tool" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> Amora Data Build Tool </label> <div class=md-nav__source> <a href=https://github.com/mundipagg/amora-data-build-tool title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> amora-data-build-tool </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Amora </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> üèó Concepts <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="üèó Concepts" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> üèó Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../concepts/amora-model/ class=md-nav__link> Amora Model </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2 type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2> Feature Store <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Feature Store" data-md-level=2> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Feature Store </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../feature-store/feature-store/ class=md-nav__link> Feature Store </a> </li> <li class=md-nav__item> <a href=../../feature-store/feature-view/ class=md-nav__link> Feature View </a> </li> <li class=md-nav__item> <a href=../../feature-store/feature-view-protocol/ class=md-nav__link> Feature View Protocol </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../concepts/data-questions/ class=md-nav__link> Data Question </a> </li> <li class=md-nav__item> <a href=../../concepts/data-visualization/ class=md-nav__link> Data Visualization </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> üßë‚Äçüè´ User Guide <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="üßë‚Äçüè´ User Guide" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> üßë‚Äçüè´ User Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../user-guide/cli/ class=md-nav__link> CLI </a> </li> <li class=md-nav__item> <a href=../../user-guide/web-ui/ class=md-nav__link> Web UI </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> üéÅ Examples <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="üéÅ Examples" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> üéÅ Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../examples/ class=md-nav__link> Amora Project </a> </li> <li class=md-nav__item> <a href=../../notebooks/feature_store/ class=md-nav__link> Feature Store Notebook </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> ‚öôÔ∏è API Reference <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="‚öôÔ∏è API Reference" data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> ‚öôÔ∏è API Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../api/storage/ class=md-nav__link> Storage </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6 checked> <label class=md-nav__link for=__nav_6> ‚ÜîÔ∏è Providers <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="‚ÜîÔ∏è Providers" data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> ‚ÜîÔ∏è Providers </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> BigQuery <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> BigQuery </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#running-queries class=md-nav__link> Running queries </a> <nav class=md-nav aria-label="Running queries"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#amora.providers.bigquery.run class=md-nav__link> run() </a> </li> <li class=md-nav__item> <a href=#amora.providers.bigquery.dry_run class=md-nav__link> dry_run() </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#building-a-cte-from-literal-values class=md-nav__link> Building a CTE from literal values </a> <nav class=md-nav aria-label="Building a CTE from literal values"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#amora.providers.bigquery.cte_from_rows class=md-nav__link> cte_from_rows() </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cost-estimation class=md-nav__link> Cost estimation </a> <nav class=md-nav aria-label="Cost estimation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#amora.providers.bigquery.estimated_query_cost_in_usd class=md-nav__link> estimated_query_cost_in_usd() </a> </li> <li class=md-nav__item> <a href=#amora.providers.bigquery.estimated_storage_cost_in_usd class=md-nav__link> estimated_storage_cost_in_usd() </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#data-schema class=md-nav__link> Data schema </a> <nav class=md-nav aria-label="Data schema"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#amora.providers.bigquery.get_schema class=md-nav__link> get_schema() </a> </li> <li class=md-nav__item> <a href=#amora.providers.bigquery.schema_for_model class=md-nav__link> schema_for_model() </a> </li> <li class=md-nav__item> <a href=#amora.providers.bigquery.schema_for_model_source class=md-nav__link> schema_for_model_source() </a> </li> <li class=md-nav__item> <a href=#amora.providers.bigquery.schema_for_struct class=md-nav__link> schema_for_struct() </a> </li> <li class=md-nav__item> <a href=#amora.providers.bigquery.struct_for_schema_field class=md-nav__link> struct_for_schema_field() </a> </li> <li class=md-nav__item> <a href=#amora.providers.bigquery.column_for_schema_field class=md-nav__link> column_for_schema_field() </a> </li> <li class=md-nav__item> <a href=#amora.providers.bigquery.schema_field_for_column class=md-nav__link> schema_field_for_column() </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#data-sample class=md-nav__link> Data Sample </a> <nav class=md-nav aria-label="Data Sample"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#amora.providers.bigquery.sample class=md-nav__link> sample() </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#repeated-fields class=md-nav__link> Repeated Fields </a> <nav class=md-nav aria-label="Repeated Fields"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#amora.providers.bigquery.array class=md-nav__link> array </a> <nav class=md-nav aria-label=array> <ul class=md-nav__list> <li class=md-nav__item> <a href=#amora.providers.bigquery.array.self_group class=md-nav__link> self_group() </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#zipping-arrays class=md-nav__link> Zipping arrays </a> <nav class=md-nav aria-label="Zipping arrays"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#amora.providers.bigquery.zip_arrays class=md-nav__link> zip_arrays() </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#structs-and-nested-models class=md-nav__link> Structs and Nested Models </a> <nav class=md-nav aria-label="Structs and Nested Models"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#amora.providers.bigquery.struct class=md-nav__link> struct </a> <nav class=md-nav aria-label=struct> <ul class=md-nav__list> <li class=md-nav__item> <a href=#amora.providers.bigquery.struct.self_group class=md-nav__link> self_group() </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#amora.providers.bigquery.struct_for_model class=md-nav__link> struct_for_model() </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> üß™ Testing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="üß™ Testing" data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> üß™ Testing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tests/assertions/ class=md-nav__link> Data Assertions </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../glossary/ class=md-nav__link> üîñ Glossary </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#running-queries class=md-nav__link> Running queries </a> <nav class=md-nav aria-label="Running queries"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#amora.providers.bigquery.run class=md-nav__link> run() </a> </li> <li class=md-nav__item> <a href=#amora.providers.bigquery.dry_run class=md-nav__link> dry_run() </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#building-a-cte-from-literal-values class=md-nav__link> Building a CTE from literal values </a> <nav class=md-nav aria-label="Building a CTE from literal values"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#amora.providers.bigquery.cte_from_rows class=md-nav__link> cte_from_rows() </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cost-estimation class=md-nav__link> Cost estimation </a> <nav class=md-nav aria-label="Cost estimation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#amora.providers.bigquery.estimated_query_cost_in_usd class=md-nav__link> estimated_query_cost_in_usd() </a> </li> <li class=md-nav__item> <a href=#amora.providers.bigquery.estimated_storage_cost_in_usd class=md-nav__link> estimated_storage_cost_in_usd() </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#data-schema class=md-nav__link> Data schema </a> <nav class=md-nav aria-label="Data schema"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#amora.providers.bigquery.get_schema class=md-nav__link> get_schema() </a> </li> <li class=md-nav__item> <a href=#amora.providers.bigquery.schema_for_model class=md-nav__link> schema_for_model() </a> </li> <li class=md-nav__item> <a href=#amora.providers.bigquery.schema_for_model_source class=md-nav__link> schema_for_model_source() </a> </li> <li class=md-nav__item> <a href=#amora.providers.bigquery.schema_for_struct class=md-nav__link> schema_for_struct() </a> </li> <li class=md-nav__item> <a href=#amora.providers.bigquery.struct_for_schema_field class=md-nav__link> struct_for_schema_field() </a> </li> <li class=md-nav__item> <a href=#amora.providers.bigquery.column_for_schema_field class=md-nav__link> column_for_schema_field() </a> </li> <li class=md-nav__item> <a href=#amora.providers.bigquery.schema_field_for_column class=md-nav__link> schema_field_for_column() </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#data-sample class=md-nav__link> Data Sample </a> <nav class=md-nav aria-label="Data Sample"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#amora.providers.bigquery.sample class=md-nav__link> sample() </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#repeated-fields class=md-nav__link> Repeated Fields </a> <nav class=md-nav aria-label="Repeated Fields"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#amora.providers.bigquery.array class=md-nav__link> array </a> <nav class=md-nav aria-label=array> <ul class=md-nav__list> <li class=md-nav__item> <a href=#amora.providers.bigquery.array.self_group class=md-nav__link> self_group() </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#zipping-arrays class=md-nav__link> Zipping arrays </a> <nav class=md-nav aria-label="Zipping arrays"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#amora.providers.bigquery.zip_arrays class=md-nav__link> zip_arrays() </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#structs-and-nested-models class=md-nav__link> Structs and Nested Models </a> <nav class=md-nav aria-label="Structs and Nested Models"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#amora.providers.bigquery.struct class=md-nav__link> struct </a> <nav class=md-nav aria-label=struct> <ul class=md-nav__list> <li class=md-nav__item> <a href=#amora.providers.bigquery.struct.self_group class=md-nav__link> self_group() </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#amora.providers.bigquery.struct_for_model class=md-nav__link> struct_for_model() </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/mundipagg/amora-data-build-tool/edit/master/docs/providers/bigquery.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1 id=bigquery>BigQuery<a class=headerlink href=#bigquery title="Permanent link">&para;</a></h1> <h2 id=running-queries>Running queries<a class=headerlink href=#running-queries title="Permanent link">&para;</a></h2> <div class="doc doc-object doc-function"> <h3 id=amora.providers.bigquery.run class="doc doc-heading"> <code class="highlight language-python"><span class=n>run</span><span class=p>(</span><span class=n>statement</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>sqlalchemy</span><span class=o>.</span><span class=n>sql</span><span class=o>.</span><span class=n>selectable</span><span class=o>.</span><span class=n>Select</span><span class=p>,</span> <span class=n>sqlalchemy</span><span class=o>.</span><span class=n>sql</span><span class=o>.</span><span class=n>selectable</span><span class=o>.</span><span class=n>Selectable</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>RunResult</span></code> <a href=#amora.providers.bigquery.run class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <p>Executes a given query and returns its results and metadata as an <code>amora.providers.bigquery.RunResult</code></p> <details class=quote> <summary>Source code in <code>amora/providers/bigquery.py</code></summary> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nd>@log_execution</span><span class=p>()</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=n>statement</span><span class=p>:</span> <span class=n>Compilable</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>RunResult</span><span class=p>:</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=sd>    Executes a given query and returns its results</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=sd>    and metadata as an `amora.providers.bigquery.RunResult`</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>    <span class=n>query</span> <span class=o>=</span> <span class=n>compile_statement</span><span class=p>(</span><span class=n>statement</span><span class=p>)</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>    <span class=n>query_job</span> <span class=o>=</span> <span class=n>get_client</span><span class=p>()</span><span class=o>.</span><span class=n>query</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>    <span class=n>rows</span> <span class=o>=</span> <span class=n>query_job</span><span class=o>.</span><span class=n>result</span><span class=p>()</span>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>    <span class=n>execution_time_delta</span> <span class=o>=</span> <span class=n>query_job</span><span class=o>.</span><span class=n>ended</span> <span class=o>-</span> <span class=n>query_job</span><span class=o>.</span><span class=n>started</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>    <span class=k>return</span> <span class=n>RunResult</span><span class=p>(</span>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>        <span class=n>execution_time_in_ms</span><span class=o>=</span><span class=n>execution_time_delta</span><span class=o>.</span><span class=n>microseconds</span> <span class=o>/</span> <span class=mi>1000</span><span class=p>,</span>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>        <span class=n>job_id</span><span class=o>=</span><span class=n>query_job</span><span class=o>.</span><span class=n>job_id</span><span class=p>,</span>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a>        <span class=n>query</span><span class=o>=</span><span class=n>query</span><span class=p>,</span>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>        <span class=n>referenced_tables</span><span class=o>=</span><span class=p>[</span>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>            <span class=s2>&quot;.&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>table</span><span class=o>.</span><span class=n>to_api_repr</span><span class=p>()</span><span class=o>.</span><span class=n>values</span><span class=p>())</span>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>            <span class=k>for</span> <span class=n>table</span> <span class=ow>in</span> <span class=n>query_job</span><span class=o>.</span><span class=n>referenced_tables</span>
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a>        <span class=p>],</span>
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a>        <span class=n>rows</span><span class=o>=</span><span class=n>rows</span><span class=p>,</span>
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a>        <span class=n>schema</span><span class=o>=</span><span class=n>query_job</span><span class=o>.</span><span class=n>schema</span><span class=p>,</span>
<a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a>        <span class=n>total_bytes</span><span class=o>=</span><span class=n>query_job</span><span class=o>.</span><span class=n>total_bytes_billed</span><span class=p>,</span>
<a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a>        <span class=n>user_email</span><span class=o>=</span><span class=n>query_job</span><span class=o>.</span><span class=n>user_email</span><span class=p>,</span>
<a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a>        <span class=n>to_dataframe</span><span class=o>=</span><span class=n>query_job</span><span class=o>.</span><span class=n>to_dataframe</span><span class=p>,</span>
<a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a>    <span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=amora.providers.bigquery.dry_run class="doc doc-heading"> <code class="highlight language-python"><span class=n>dry_run</span><span class=p>(</span><span class=n>model</span><span class=p>:</span> <span class=n>Type</span><span class=p>[</span><span class=n>AmoraModel</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>amora</span><span class=o>.</span><span class=n>providers</span><span class=o>.</span><span class=n>bigquery</span><span class=o>.</span><span class=n>DryRunResult</span><span class=p>]</span></code> <a href=#amora.providers.bigquery.dry_run class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <div class=highlight><pre><span></span><code>You can use the estimate returned by the dry run to calculate query
costs in the pricing calculator. Also useful to verify user permissions
and query validity. You are not charged for performing the dry run.

Read more: https://cloud.google.com/bigquery/docs/dry-run-queries

E.g:
```python
dry_run(HeartRate)
```

Will result in:

```python
DryRunResult(
    total_bytes_processed=170181834,
    query=&quot;SELECT
</code></pre></div> <p><code>health</code>.<code>creationDate</code>, <code>health</code>.<code>device</code>, <code>health</code>.<code>endDate</code>, <code>health</code>.<code>id</code>, <code>health</code>.<code>sourceName</code>, <code>health</code>.<code>startDate</code>, <code>health</code>.<code>unit</code>, <code>health</code>.<code>value</code> FROM <code>diogo</code>.<code>health</code> WHERE <code>health</code>.<code>type</code> = 'HeartRate'", model=HeartRate, referenced_tables=["amora-data-build-tool.diogo.health"], schema=[ SchemaField("creationDate", "TIMESTAMP", "NULLABLE", None, (), None), SchemaField("device", "STRING", "NULLABLE", None, (), None), SchemaField("endDate", "TIMESTAMP", "NULLABLE", None, (), None), SchemaField("id", "INTEGER", "NULLABLE", None, (), None), SchemaField("sourceName", "STRING", "NULLABLE", None, (), None), SchemaField("startDate", "TIMESTAMP", "NULLABLE", None, (), None), SchemaField("unit", "STRING", "NULLABLE", None, (), None), SchemaField("value", "FLOAT", "NULLABLE", None, (), None), ], ) ```</p> <details class=quote> <summary>Source code in <code>amora/providers/bigquery.py</code></summary> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nd>@log_execution</span><span class=p>()</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=k>def</span> <span class=nf>dry_run</span><span class=p>(</span><span class=n>model</span><span class=p>:</span> <span class=n>Model</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>DryRunResult</span><span class=p>]:</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=sd>    You can use the estimate returned by the dry run to calculate query</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=sd>    costs in the pricing calculator. Also useful to verify user permissions</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=sd>    and query validity. You are not charged for performing the dry run.</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=sd>    Read more: https://cloud.google.com/bigquery/docs/dry-run-queries</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=sd>    E.g:</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=sd>    ```python</span>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=sd>    dry_run(HeartRate)</span>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=sd>    ```</span>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=sd>    Will result in:</span>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a><span class=sd>    ```python</span>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a><span class=sd>    DryRunResult(</span>
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a><span class=sd>        total_bytes_processed=170181834,</span>
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a><span class=sd>        query=&quot;SELECT\n  `health`.`creationDate`,\n  `health`.`device`,\n  `health`.`endDate`,\n  `health`.`id`,\n  `health`.`sourceName`,\n  `health`.`startDate`,\n  `health`.`unit`,\n  `health`.`value`\nFROM `diogo`.`health`\nWHERE `health`.`type` = &#39;HeartRate&#39;&quot;,</span>
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a><span class=sd>        model=HeartRate,</span>
<a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a><span class=sd>        referenced_tables=[&quot;amora-data-build-tool.diogo.health&quot;],</span>
<a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a><span class=sd>        schema=[</span>
<a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a><span class=sd>            SchemaField(&quot;creationDate&quot;, &quot;TIMESTAMP&quot;, &quot;NULLABLE&quot;, None, (), None),</span>
<a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a><span class=sd>            SchemaField(&quot;device&quot;, &quot;STRING&quot;, &quot;NULLABLE&quot;, None, (), None),</span>
<a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a><span class=sd>            SchemaField(&quot;endDate&quot;, &quot;TIMESTAMP&quot;, &quot;NULLABLE&quot;, None, (), None),</span>
<a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a><span class=sd>            SchemaField(&quot;id&quot;, &quot;INTEGER&quot;, &quot;NULLABLE&quot;, None, (), None),</span>
<a id=__codelineno-0-28 name=__codelineno-0-28 href=#__codelineno-0-28></a><span class=sd>            SchemaField(&quot;sourceName&quot;, &quot;STRING&quot;, &quot;NULLABLE&quot;, None, (), None),</span>
<a id=__codelineno-0-29 name=__codelineno-0-29 href=#__codelineno-0-29></a><span class=sd>            SchemaField(&quot;startDate&quot;, &quot;TIMESTAMP&quot;, &quot;NULLABLE&quot;, None, (), None),</span>
<a id=__codelineno-0-30 name=__codelineno-0-30 href=#__codelineno-0-30></a><span class=sd>            SchemaField(&quot;unit&quot;, &quot;STRING&quot;, &quot;NULLABLE&quot;, None, (), None),</span>
<a id=__codelineno-0-31 name=__codelineno-0-31 href=#__codelineno-0-31></a><span class=sd>            SchemaField(&quot;value&quot;, &quot;FLOAT&quot;, &quot;NULLABLE&quot;, None, (), None),</span>
<a id=__codelineno-0-32 name=__codelineno-0-32 href=#__codelineno-0-32></a><span class=sd>        ],</span>
<a id=__codelineno-0-33 name=__codelineno-0-33 href=#__codelineno-0-33></a><span class=sd>    )</span>
<a id=__codelineno-0-34 name=__codelineno-0-34 href=#__codelineno-0-34></a><span class=sd>    ```</span>
<a id=__codelineno-0-35 name=__codelineno-0-35 href=#__codelineno-0-35></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-36 name=__codelineno-0-36 href=#__codelineno-0-36></a>    <span class=n>client</span> <span class=o>=</span> <span class=n>get_client</span><span class=p>()</span>
<a id=__codelineno-0-37 name=__codelineno-0-37 href=#__codelineno-0-37></a>    <span class=n>source</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>source</span><span class=p>()</span>
<a id=__codelineno-0-38 name=__codelineno-0-38 href=#__codelineno-0-38></a>    <span class=k>if</span> <span class=n>source</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-39 name=__codelineno-0-39 href=#__codelineno-0-39></a>        <span class=n>table</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>get_table</span><span class=p>(</span><span class=n>model</span><span class=o>.</span><span class=n>fully_qualified_name</span><span class=p>())</span>
<a id=__codelineno-0-40 name=__codelineno-0-40 href=#__codelineno-0-40></a>
<a id=__codelineno-0-41 name=__codelineno-0-41 href=#__codelineno-0-41></a>        <span class=k>if</span> <span class=n>table</span><span class=o>.</span><span class=n>table_type</span> <span class=o>==</span> <span class=s2>&quot;VIEW&quot;</span><span class=p>:</span>
<a id=__codelineno-0-42 name=__codelineno-0-42 href=#__codelineno-0-42></a>            <span class=n>query_job</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>query</span><span class=p>(</span>
<a id=__codelineno-0-43 name=__codelineno-0-43 href=#__codelineno-0-43></a>                <span class=n>query</span><span class=o>=</span><span class=n>table</span><span class=o>.</span><span class=n>view_query</span><span class=p>,</span>
<a id=__codelineno-0-44 name=__codelineno-0-44 href=#__codelineno-0-44></a>                <span class=n>job_config</span><span class=o>=</span><span class=n>QueryJobConfig</span><span class=p>(</span><span class=n>dry_run</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>use_query_cache</span><span class=o>=</span><span class=kc>False</span><span class=p>),</span>
<a id=__codelineno-0-45 name=__codelineno-0-45 href=#__codelineno-0-45></a>            <span class=p>)</span>
<a id=__codelineno-0-46 name=__codelineno-0-46 href=#__codelineno-0-46></a>            <span class=k>return</span> <span class=n>DryRunResult</span><span class=p>(</span>
<a id=__codelineno-0-47 name=__codelineno-0-47 href=#__codelineno-0-47></a>                <span class=n>job_id</span><span class=o>=</span><span class=n>query_job</span><span class=o>.</span><span class=n>job_id</span><span class=p>,</span>
<a id=__codelineno-0-48 name=__codelineno-0-48 href=#__codelineno-0-48></a>                <span class=n>model</span><span class=o>=</span><span class=n>model</span><span class=p>,</span>
<a id=__codelineno-0-49 name=__codelineno-0-49 href=#__codelineno-0-49></a>                <span class=n>query</span><span class=o>=</span><span class=n>table</span><span class=o>.</span><span class=n>view_query</span><span class=p>,</span>
<a id=__codelineno-0-50 name=__codelineno-0-50 href=#__codelineno-0-50></a>                <span class=n>referenced_tables</span><span class=o>=</span><span class=p>[</span>
<a id=__codelineno-0-51 name=__codelineno-0-51 href=#__codelineno-0-51></a>                    <span class=s2>&quot;.&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>table</span><span class=o>.</span><span class=n>to_api_repr</span><span class=p>()</span><span class=o>.</span><span class=n>values</span><span class=p>())</span>
<a id=__codelineno-0-52 name=__codelineno-0-52 href=#__codelineno-0-52></a>                    <span class=k>for</span> <span class=n>table</span> <span class=ow>in</span> <span class=n>query_job</span><span class=o>.</span><span class=n>referenced_tables</span>
<a id=__codelineno-0-53 name=__codelineno-0-53 href=#__codelineno-0-53></a>                <span class=p>],</span>
<a id=__codelineno-0-54 name=__codelineno-0-54 href=#__codelineno-0-54></a>                <span class=n>schema</span><span class=o>=</span><span class=n>query_job</span><span class=o>.</span><span class=n>schema</span><span class=p>,</span>
<a id=__codelineno-0-55 name=__codelineno-0-55 href=#__codelineno-0-55></a>                <span class=n>total_bytes</span><span class=o>=</span><span class=n>query_job</span><span class=o>.</span><span class=n>total_bytes_processed</span><span class=p>,</span>
<a id=__codelineno-0-56 name=__codelineno-0-56 href=#__codelineno-0-56></a>                <span class=n>user_email</span><span class=o>=</span><span class=n>query_job</span><span class=o>.</span><span class=n>user_email</span><span class=p>,</span>
<a id=__codelineno-0-57 name=__codelineno-0-57 href=#__codelineno-0-57></a>            <span class=p>)</span>
<a id=__codelineno-0-58 name=__codelineno-0-58 href=#__codelineno-0-58></a>
<a id=__codelineno-0-59 name=__codelineno-0-59 href=#__codelineno-0-59></a>        <span class=k>return</span> <span class=n>DryRunResult</span><span class=p>(</span>
<a id=__codelineno-0-60 name=__codelineno-0-60 href=#__codelineno-0-60></a>            <span class=n>job_id</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-61 name=__codelineno-0-61 href=#__codelineno-0-61></a>            <span class=n>model</span><span class=o>=</span><span class=n>model</span><span class=p>,</span>
<a id=__codelineno-0-62 name=__codelineno-0-62 href=#__codelineno-0-62></a>            <span class=n>query</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-63 name=__codelineno-0-63 href=#__codelineno-0-63></a>            <span class=n>referenced_tables</span><span class=o>=</span><span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>table</span><span class=o>.</span><span class=n>reference</span><span class=p>)],</span>
<a id=__codelineno-0-64 name=__codelineno-0-64 href=#__codelineno-0-64></a>            <span class=n>schema</span><span class=o>=</span><span class=n>table</span><span class=o>.</span><span class=n>schema</span><span class=p>,</span>
<a id=__codelineno-0-65 name=__codelineno-0-65 href=#__codelineno-0-65></a>            <span class=n>total_bytes</span><span class=o>=</span><span class=n>table</span><span class=o>.</span><span class=n>num_bytes</span><span class=p>,</span>
<a id=__codelineno-0-66 name=__codelineno-0-66 href=#__codelineno-0-66></a>            <span class=n>user_email</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-67 name=__codelineno-0-67 href=#__codelineno-0-67></a>        <span class=p>)</span>
<a id=__codelineno-0-68 name=__codelineno-0-68 href=#__codelineno-0-68></a>
<a id=__codelineno-0-69 name=__codelineno-0-69 href=#__codelineno-0-69></a>    <span class=n>query</span> <span class=o>=</span> <span class=n>compile_statement</span><span class=p>(</span><span class=n>source</span><span class=p>)</span>
<a id=__codelineno-0-70 name=__codelineno-0-70 href=#__codelineno-0-70></a>    <span class=k>try</span><span class=p>:</span>
<a id=__codelineno-0-71 name=__codelineno-0-71 href=#__codelineno-0-71></a>        <span class=n>query_job</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>query</span><span class=p>(</span>
<a id=__codelineno-0-72 name=__codelineno-0-72 href=#__codelineno-0-72></a>            <span class=n>query</span><span class=o>=</span><span class=n>query</span><span class=p>,</span>
<a id=__codelineno-0-73 name=__codelineno-0-73 href=#__codelineno-0-73></a>            <span class=n>job_config</span><span class=o>=</span><span class=n>QueryJobConfig</span><span class=p>(</span><span class=n>dry_run</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>use_query_cache</span><span class=o>=</span><span class=kc>False</span><span class=p>),</span>
<a id=__codelineno-0-74 name=__codelineno-0-74 href=#__codelineno-0-74></a>        <span class=p>)</span>
<a id=__codelineno-0-75 name=__codelineno-0-75 href=#__codelineno-0-75></a>    <span class=k>except</span> <span class=n>NotFound</span><span class=p>:</span>
<a id=__codelineno-0-76 name=__codelineno-0-76 href=#__codelineno-0-76></a>        <span class=n>logger</span><span class=o>.</span><span class=n>exception</span><span class=p>(</span>
<a id=__codelineno-0-77 name=__codelineno-0-77 href=#__codelineno-0-77></a>            <span class=s2>&quot;The query may contain model references that are not materialized.&quot;</span><span class=p>,</span>
<a id=__codelineno-0-78 name=__codelineno-0-78 href=#__codelineno-0-78></a>            <span class=n>extra</span><span class=o>=</span><span class=p>{</span><span class=s2>&quot;sql&quot;</span><span class=p>:</span> <span class=n>query</span><span class=p>},</span>
<a id=__codelineno-0-79 name=__codelineno-0-79 href=#__codelineno-0-79></a>        <span class=p>)</span>
<a id=__codelineno-0-80 name=__codelineno-0-80 href=#__codelineno-0-80></a>        <span class=k>return</span> <span class=kc>None</span>
<a id=__codelineno-0-81 name=__codelineno-0-81 href=#__codelineno-0-81></a>    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-82 name=__codelineno-0-82 href=#__codelineno-0-82></a>        <span class=k>return</span> <span class=n>DryRunResult</span><span class=p>(</span>
<a id=__codelineno-0-83 name=__codelineno-0-83 href=#__codelineno-0-83></a>            <span class=n>job_id</span><span class=o>=</span><span class=n>query_job</span><span class=o>.</span><span class=n>job_id</span><span class=p>,</span>
<a id=__codelineno-0-84 name=__codelineno-0-84 href=#__codelineno-0-84></a>            <span class=n>total_bytes</span><span class=o>=</span><span class=n>query_job</span><span class=o>.</span><span class=n>total_bytes_processed</span><span class=p>,</span>
<a id=__codelineno-0-85 name=__codelineno-0-85 href=#__codelineno-0-85></a>            <span class=n>referenced_tables</span><span class=o>=</span><span class=p>[</span>
<a id=__codelineno-0-86 name=__codelineno-0-86 href=#__codelineno-0-86></a>                <span class=s2>&quot;.&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>table</span><span class=o>.</span><span class=n>to_api_repr</span><span class=p>()</span><span class=o>.</span><span class=n>values</span><span class=p>())</span>
<a id=__codelineno-0-87 name=__codelineno-0-87 href=#__codelineno-0-87></a>                <span class=k>for</span> <span class=n>table</span> <span class=ow>in</span> <span class=n>query_job</span><span class=o>.</span><span class=n>referenced_tables</span>
<a id=__codelineno-0-88 name=__codelineno-0-88 href=#__codelineno-0-88></a>            <span class=p>],</span>
<a id=__codelineno-0-89 name=__codelineno-0-89 href=#__codelineno-0-89></a>            <span class=n>query</span><span class=o>=</span><span class=n>query</span><span class=p>,</span>
<a id=__codelineno-0-90 name=__codelineno-0-90 href=#__codelineno-0-90></a>            <span class=n>model</span><span class=o>=</span><span class=n>model</span><span class=p>,</span>
<a id=__codelineno-0-91 name=__codelineno-0-91 href=#__codelineno-0-91></a>            <span class=n>schema</span><span class=o>=</span><span class=n>query_job</span><span class=o>.</span><span class=n>schema</span><span class=p>,</span>
<a id=__codelineno-0-92 name=__codelineno-0-92 href=#__codelineno-0-92></a>            <span class=n>user_email</span><span class=o>=</span><span class=n>query_job</span><span class=o>.</span><span class=n>user_email</span><span class=p>,</span>
<a id=__codelineno-0-93 name=__codelineno-0-93 href=#__codelineno-0-93></a>        <span class=p>)</span>
</code></pre></div> </details> </div> </div> <h2 id=building-a-cte-from-literal-values>Building a CTE from literal values<a class=headerlink href=#building-a-cte-from-literal-values title="Permanent link">&para;</a></h2> <div class="doc doc-object doc-function"> <h3 id=amora.providers.bigquery.cte_from_rows class="doc doc-heading"> <code class="highlight language-python"><span class=n>cte_from_rows</span><span class=p>(</span><span class=n>rows</span><span class=p>:</span> <span class=n>Iterable</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=n>Hashable</span><span class=p>,</span> <span class=n>Any</span><span class=p>]])</span> <span class=o>-&gt;</span> <span class=n>CTE</span></code> <a href=#amora.providers.bigquery.cte_from_rows class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <p>Returns a table like selectable (CTE) for the given hardcoded values.</p> <p>E.g: <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=n>rows</span> <span class=o>=</span> <span class=p>[{</span><span class=s2>&quot;numeric_column&quot;</span><span class=p>:</span> <span class=s2>&quot;123&quot;</span><span class=p>},</span> <span class=p>{</span><span class=s2>&quot;numeric_column&quot;</span><span class=p>:</span> <span class=s2>&quot;234&quot;</span><span class=p>},</span> <span class=p>{</span><span class=s2>&quot;numeric_column&quot;</span><span class=p>:</span> <span class=s2>&quot;345&quot;</span><span class=p>}]</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=n>cte_from_rows</span><span class=p>(</span><span class=n>rows</span><span class=p>)</span>
</code></pre></div></p> <p>Will result in the following SQL</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=w>    </span><span class=k>WITH</span><span class=w> </span><span class=o>`</span><span class=n>annon_1</span><span class=o>`</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=w>        </span><span class=k>SELECT</span><span class=w> </span><span class=ss>&quot;123&quot;</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>numeric_column</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=w>        </span><span class=k>UNION</span><span class=w> </span><span class=k>ALL</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=ss>&quot;234 AS numeric_column</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=ss>        UNION ALL SELECT &quot;</span><span class=mi>345</span><span class=err>&quot;</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>numeric_column</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=w>    </span><span class=p>)</span>
</code></pre></div> <p>Which would render a table like:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>| numeric_column |
<a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>|----------------|
<a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>| 123            |
<a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>| 234            |
<a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>| 345            |
</code></pre></div> <p>Useful both for model writing and testing purposes. Think of <code>cte_from_rows</code> as way of generating a "temporary table like object", with data available at runtime.</p> <details class=quote> <summary>Source code in <code>amora/providers/bigquery.py</code></summary> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>def</span> <span class=nf>cte_from_rows</span><span class=p>(</span><span class=n>rows</span><span class=p>:</span> <span class=n>Iterable</span><span class=p>[</span><span class=n>Dict</span><span class=p>[</span><span class=n>Hashable</span><span class=p>,</span> <span class=n>Any</span><span class=p>]])</span> <span class=o>-&gt;</span> <span class=n>CTE</span><span class=p>:</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=sd>    Returns a table like selectable (CTE) for the given hardcoded values.</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=sd>    E.g:</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=sd>    ```python</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=sd>    rows = [{&quot;numeric_column&quot;: &quot;123&quot;}, {&quot;numeric_column&quot;: &quot;234&quot;}, {&quot;numeric_column&quot;: &quot;345&quot;}]</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=sd>    cte_from_rows(rows)</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=sd>    ```</span>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=sd>    Will result in the following SQL</span>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=sd>    ```sql</span>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=sd>        WITH `annon_1` AS (</span>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=sd>            SELECT &quot;123&quot; AS numeric_column</span>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=sd>            UNION ALL SELECT &quot;234 AS numeric_column</span>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a><span class=sd>            UNION ALL SELECT &quot;345&quot; AS numeric_column</span>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a><span class=sd>        )</span>
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a><span class=sd>    ```</span>
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a>
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a><span class=sd>    Which would render a table like:</span>
<a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a>
<a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a><span class=sd>    ```md</span>
<a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a><span class=sd>    | numeric_column |</span>
<a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a><span class=sd>    |----------------|</span>
<a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a><span class=sd>    | 123            |</span>
<a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a><span class=sd>    | 234            |</span>
<a id=__codelineno-0-28 name=__codelineno-0-28 href=#__codelineno-0-28></a><span class=sd>    | 345            |</span>
<a id=__codelineno-0-29 name=__codelineno-0-29 href=#__codelineno-0-29></a><span class=sd>    ```</span>
<a id=__codelineno-0-30 name=__codelineno-0-30 href=#__codelineno-0-30></a>
<a id=__codelineno-0-31 name=__codelineno-0-31 href=#__codelineno-0-31></a><span class=sd>    Useful both for model writing and testing purposes. Think of `cte_from_rows` as way of generating</span>
<a id=__codelineno-0-32 name=__codelineno-0-32 href=#__codelineno-0-32></a><span class=sd>    a &quot;temporary table like object&quot;, with data available at runtime.</span>
<a id=__codelineno-0-33 name=__codelineno-0-33 href=#__codelineno-0-33></a>
<a id=__codelineno-0-34 name=__codelineno-0-34 href=#__codelineno-0-34></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-35 name=__codelineno-0-35 href=#__codelineno-0-35></a>
<a id=__codelineno-0-36 name=__codelineno-0-36 href=#__codelineno-0-36></a>    <span class=k>def</span> <span class=nf>gen_selects</span><span class=p>(</span><span class=n>rows</span><span class=p>):</span>
<a id=__codelineno-0-37 name=__codelineno-0-37 href=#__codelineno-0-37></a>        <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>rows</span><span class=p>:</span>
<a id=__codelineno-0-38 name=__codelineno-0-38 href=#__codelineno-0-38></a>            <span class=n>cols</span> <span class=o>=</span> <span class=p>[]</span>
<a id=__codelineno-0-39 name=__codelineno-0-39 href=#__codelineno-0-39></a>            <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>row</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
<a id=__codelineno-0-40 name=__codelineno-0-40 href=#__codelineno-0-40></a>                <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>array</span><span class=p>):</span>
<a id=__codelineno-0-41 name=__codelineno-0-41 href=#__codelineno-0-41></a>                    <span class=n>cols</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>value</span><span class=o>.</span><span class=n>label</span><span class=p>(</span><span class=n>name</span><span class=p>))</span>
<a id=__codelineno-0-42 name=__codelineno-0-42 href=#__codelineno-0-42></a>                <span class=k>elif</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=n>AmoraModel</span><span class=p>):</span>
<a id=__codelineno-0-43 name=__codelineno-0-43 href=#__codelineno-0-43></a>                    <span class=n>cols</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>struct</span><span class=p>(</span><span class=n>value</span><span class=p>)</span><span class=o>.</span><span class=n>label</span><span class=p>(</span><span class=n>name</span><span class=p>))</span>
<a id=__codelineno-0-44 name=__codelineno-0-44 href=#__codelineno-0-44></a>                <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-45 name=__codelineno-0-45 href=#__codelineno-0-45></a>                    <span class=n>cols</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>literal</span><span class=p>(</span><span class=n>value</span><span class=p>)</span><span class=o>.</span><span class=n>label</span><span class=p>(</span><span class=n>name</span><span class=p>))</span>
<a id=__codelineno-0-46 name=__codelineno-0-46 href=#__codelineno-0-46></a>            <span class=k>yield</span> <span class=n>select</span><span class=p>(</span><span class=o>*</span><span class=n>cols</span><span class=p>)</span>
<a id=__codelineno-0-47 name=__codelineno-0-47 href=#__codelineno-0-47></a>
<a id=__codelineno-0-48 name=__codelineno-0-48 href=#__codelineno-0-48></a>    <span class=n>selects</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>gen_selects</span><span class=p>(</span><span class=n>rows</span><span class=p>))</span>
<a id=__codelineno-0-49 name=__codelineno-0-49 href=#__codelineno-0-49></a>
<a id=__codelineno-0-50 name=__codelineno-0-50 href=#__codelineno-0-50></a>    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>selects</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
<a id=__codelineno-0-51 name=__codelineno-0-51 href=#__codelineno-0-51></a>        <span class=k>return</span> <span class=n>selects</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>cte</span><span class=p>()</span>
<a id=__codelineno-0-52 name=__codelineno-0-52 href=#__codelineno-0-52></a>
<a id=__codelineno-0-53 name=__codelineno-0-53 href=#__codelineno-0-53></a>    <span class=k>return</span> <span class=n>union_all</span><span class=p>(</span><span class=o>*</span><span class=n>selects</span><span class=p>)</span><span class=o>.</span><span class=n>cte</span><span class=p>()</span>
</code></pre></div> </details> </div> </div> <h2 id=cost-estimation>Cost estimation<a class=headerlink href=#cost-estimation title="Permanent link">&para;</a></h2> <div class="doc doc-object doc-function"> <h3 id=amora.providers.bigquery.estimated_query_cost_in_usd class="doc doc-heading"> <code class="highlight language-python"><span class=n>estimated_query_cost_in_usd</span><span class=p>(</span><span class=n>total_bytes</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span></code> <a href=#amora.providers.bigquery.estimated_query_cost_in_usd class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <p>By default, queries are billed using the on-demand pricing model, where you pay for the data scanned by your queries.</p> <ul> <li>This function doesn't take into consideration that the first 1 TB per month is free.</li> <li>By default, the estimation is based on BigQuery's <code>On-demand analysis</code> pricing, which may change over time and may vary according to regions and your personal contract with GCP.</li> </ul> <p>You may set <code>AMORA_GCP_BIGQUERY_ON_DEMAND_COST_PER_TERABYTE_IN_USD</code> to the appropriate value for your use case.</p> <p>More on: https://cloud.google.com/bigquery/pricing#analysis_pricing_models</p> <p>:param total_bytes: Total data processed by the query :return: The estimated cost in USD, based on <code>On-demand</code> price</p> <details class=quote> <summary>Source code in <code>amora/providers/bigquery.py</code></summary> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>def</span> <span class=nf>estimated_query_cost_in_usd</span><span class=p>(</span><span class=n>total_bytes</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=sd>    By default, queries are billed using the on-demand pricing model,</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=sd>    where you pay for the data scanned by your queries.</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=sd>    - This function doesn&#39;t take into consideration that the first 1 TB per month is free.</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=sd>    - By default, the estimation is based on BigQuery&#39;s `On-demand analysis` pricing, which may change over time and</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=sd>    may vary according to regions and your personal contract with GCP.</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=sd>    You may set `AMORA_GCP_BIGQUERY_ON_DEMAND_COST_PER_TERABYTE_IN_USD` to the appropriate value for your use case.</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=sd>    More on: https://cloud.google.com/bigquery/pricing#analysis_pricing_models</span>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=sd>    :param total_bytes: Total data processed by the query</span>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=sd>    :return: The estimated cost in USD, based on `On-demand` price</span>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>    <span class=n>total_terabytes</span> <span class=o>=</span> <span class=n>total_bytes</span> <span class=o>/</span> <span class=mi>1024</span><span class=o>**</span><span class=mi>4</span>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>    <span class=k>return</span> <span class=n>total_terabytes</span> <span class=o>*</span> <span class=n>settings</span><span class=o>.</span><span class=n>GCP_BIGQUERY_ON_DEMAND_COST_PER_TERABYTE_IN_USD</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=amora.providers.bigquery.estimated_storage_cost_in_usd class="doc doc-heading"> <code class="highlight language-python"><span class=n>estimated_storage_cost_in_usd</span><span class=p>(</span><span class=n>total_bytes</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span></code> <a href=#amora.providers.bigquery.estimated_storage_cost_in_usd class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <p>Storage pricing is the cost to store data that you load into BigQuery. <code>Active storage</code> includes any table or table partition that has been modified in the last 90 days.</p> <ul> <li>This function doesn't take into consideration that the first 10 GB of storage per month is free.</li> <li>By default, the estimation is based on BigQuery's <code>Active Storage</code> cost per GB, which may change over time and may vary according to regions and your personal contract with GCP.</li> </ul> <p>You may set <code>AMORA_GCP_BIGQUERY_ACTIVE_STORAGE_COST_PER_GIGABYTE_IN_USD</code> to the appropriate value for your use case.</p> <p>More on: https://cloud.google.com/bigquery/pricing#storage</p> <p>:param total_bytes: Total bytes stored into the table :return: The estimated cost in USD, based on <code>Active storage</code> price</p> <details class=quote> <summary>Source code in <code>amora/providers/bigquery.py</code></summary> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>def</span> <span class=nf>estimated_storage_cost_in_usd</span><span class=p>(</span><span class=n>total_bytes</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>float</span><span class=p>:</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=sd>    Storage pricing is the cost to store data that you load into BigQuery.</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=sd>    `Active storage` includes any table or table partition that has been modified in the last 90 days.</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=sd>    - This function doesn&#39;t take into consideration that the first 10 GB of storage per month is free.</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=sd>    - By default, the estimation is based on BigQuery&#39;s `Active Storage` cost per GB, which may change over time and</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=sd>    may vary according to regions and your personal contract with GCP.</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=sd>    You may set `AMORA_GCP_BIGQUERY_ACTIVE_STORAGE_COST_PER_GIGABYTE_IN_USD` to the appropriate value for your use case.</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=sd>    More on: https://cloud.google.com/bigquery/pricing#storage</span>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=sd>    :param total_bytes: Total bytes stored into the table</span>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=sd>    :return: The estimated cost in USD, based on `Active storage` price</span>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>    <span class=n>total_gigabytes</span> <span class=o>=</span> <span class=n>total_bytes</span> <span class=o>/</span> <span class=mi>1024</span><span class=o>**</span><span class=mi>3</span>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>    <span class=k>return</span> <span class=p>(</span>
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a>        <span class=n>total_gigabytes</span> <span class=o>*</span> <span class=n>settings</span><span class=o>.</span><span class=n>GCP_BIGQUERY_ACTIVE_STORAGE_COST_PER_GIGABYTE_IN_USD</span>
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a>    <span class=p>)</span>
</code></pre></div> </details> </div> </div> <h2 id=data-schema>Data schema<a class=headerlink href=#data-schema title="Permanent link">&para;</a></h2> <div class="doc doc-object doc-function"> <h3 id=amora.providers.bigquery.get_schema class="doc doc-heading"> <code class="highlight language-python"><span class=n>get_schema</span><span class=p>(</span><span class=n>table_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>google</span><span class=o>.</span><span class=n>cloud</span><span class=o>.</span><span class=n>bigquery</span><span class=o>.</span><span class=n>schema</span><span class=o>.</span><span class=n>SchemaField</span><span class=p>]</span></code> <a href=#amora.providers.bigquery.get_schema class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <p>Given a <code>table_id</code>, returns the <code>Schema</code> of the table by querying BigQueries API</p> <details class=quote> <summary>Source code in <code>amora/providers/bigquery.py</code></summary> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>def</span> <span class=nf>get_schema</span><span class=p>(</span><span class=n>table_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Schema</span><span class=p>:</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=sd>    Given a `table_id`, returns the `Schema` of the table by querying BigQueries API</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>    <span class=n>client</span> <span class=o>=</span> <span class=n>get_client</span><span class=p>()</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>    <span class=n>table</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>get_table</span><span class=p>(</span><span class=n>table_id</span><span class=p>)</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>    <span class=k>return</span> <span class=n>table</span><span class=o>.</span><span class=n>schema</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=amora.providers.bigquery.schema_for_model class="doc doc-heading"> <code class="highlight language-python"><span class=n>schema_for_model</span><span class=p>(</span><span class=n>model</span><span class=p>:</span> <span class=n>Type</span><span class=p>[</span><span class=n>AmoraModel</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>google</span><span class=o>.</span><span class=n>cloud</span><span class=o>.</span><span class=n>bigquery</span><span class=o>.</span><span class=n>schema</span><span class=o>.</span><span class=n>SchemaField</span><span class=p>]</span></code> <a href=#amora.providers.bigquery.schema_for_model class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <p>Given an <code>AmoraModel</code>, returns the equivalent bigquery <code>Schema</code> of the model by parsing the model SQLAlchemy column schema</p> <details class=quote> <summary>Source code in <code>amora/providers/bigquery.py</code></summary> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>def</span> <span class=nf>schema_for_model</span><span class=p>(</span><span class=n>model</span><span class=p>:</span> <span class=n>Model</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Schema</span><span class=p>:</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=sd>    Given an `AmoraModel`, returns the equivalent bigquery `Schema`</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=sd>    of the model by parsing the model SQLAlchemy column schema</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>    <span class=n>columns</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>__table__</span><span class=o>.</span><span class=n>columns</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>    <span class=k>return</span> <span class=p>[</span><span class=n>schema_field_for_column</span><span class=p>(</span><span class=n>col</span><span class=p>)</span> <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=n>columns</span><span class=p>]</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=amora.providers.bigquery.schema_for_model_source class="doc doc-heading"> <code class="highlight language-python"><span class=n>schema_for_model_source</span><span class=p>(</span><span class=n>model</span><span class=p>:</span> <span class=n>Type</span><span class=p>[</span><span class=n>AmoraModel</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>google</span><span class=o>.</span><span class=n>cloud</span><span class=o>.</span><span class=n>bigquery</span><span class=o>.</span><span class=n>schema</span><span class=o>.</span><span class=n>SchemaField</span><span class=p>]]</span></code> <a href=#amora.providers.bigquery.schema_for_model_source class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <p>Give an <code>Amora Model</code>, returns the bigquery <code>Schema</code> of its <code>source</code> classmethod query result</p> <details class=quote> <summary>Source code in <code>amora/providers/bigquery.py</code></summary> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>def</span> <span class=nf>schema_for_model_source</span><span class=p>(</span><span class=n>model</span><span class=p>:</span> <span class=n>Model</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Schema</span><span class=p>]:</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=sd>    Give an `Amora Model`, returns the bigquery `Schema` of its</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=sd>    `source` classmethod query result</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>    <span class=n>source</span> <span class=o>=</span> <span class=n>model</span><span class=o>.</span><span class=n>source</span><span class=p>()</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>    <span class=k>if</span> <span class=n>source</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>        <span class=k>return</span> <span class=kc>None</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>    <span class=n>result</span> <span class=o>=</span> <span class=n>dry_run</span><span class=p>(</span><span class=n>model</span><span class=p>)</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>    <span class=k>if</span> <span class=n>result</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>        <span class=k>return</span> <span class=kc>None</span>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>    <span class=k>return</span> <span class=n>result</span><span class=o>.</span><span class=n>schema</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=amora.providers.bigquery.schema_for_struct class="doc doc-heading"> <code class="highlight language-python"><span class=n>schema_for_struct</span><span class=p>(</span><span class=n>struct</span><span class=p>:</span> <span class=n>STRUCT</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>google</span><span class=o>.</span><span class=n>cloud</span><span class=o>.</span><span class=n>bigquery</span><span class=o>.</span><span class=n>schema</span><span class=o>.</span><span class=n>SchemaField</span><span class=p>]</span></code> <a href=#amora.providers.bigquery.schema_for_struct class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <details class=quote> <summary>Source code in <code>amora/providers/bigquery.py</code></summary> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>def</span> <span class=nf>schema_for_struct</span><span class=p>(</span><span class=n>struct</span><span class=p>:</span> <span class=n>STRUCT</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Schema</span><span class=p>:</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>    <span class=k>return</span> <span class=p>[</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>        <span class=n>SchemaField</span><span class=p>(</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>            <span class=n>name</span><span class=o>=</span><span class=n>name</span><span class=p>,</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>            <span class=n>field_type</span><span class=o>=</span><span class=n>SQLALCHEMY_TYPES_TO_BIGQUERY_TYPES</span><span class=p>[</span><span class=n>sqla_type</span><span class=o>.</span><span class=vm>__class__</span><span class=p>],</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>        <span class=p>)</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>        <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>sqla_type</span> <span class=ow>in</span> <span class=n>struct</span><span class=o>.</span><span class=n>_STRUCT_fields</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>    <span class=p>]</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=amora.providers.bigquery.struct_for_schema_field class="doc doc-heading"> <code class="highlight language-python"><span class=n>struct_for_schema_field</span><span class=p>(</span><span class=n>schema_field</span><span class=p>:</span> <span class=n>SchemaField</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>STRUCT</span></code> <a href=#amora.providers.bigquery.struct_for_schema_field class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <p>Build a BigQuery Struct type from a <code>google.cloud.bigquery.schema.SchemaField</code></p> <p>Read more: https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types#struct_type</p> <details class=quote> <summary>Source code in <code>amora/providers/bigquery.py</code></summary> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>def</span> <span class=nf>struct_for_schema_field</span><span class=p>(</span><span class=n>schema_field</span><span class=p>:</span> <span class=n>SchemaField</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>STRUCT</span><span class=p>:</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=sd>    Build a BigQuery Struct type from a `google.cloud.bigquery.schema.SchemaField`</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=sd>    Read more: https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types#struct_type</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>    <span class=k>def</span> <span class=nf>fields</span><span class=p>():</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>        <span class=k>for</span> <span class=n>field</span> <span class=ow>in</span> <span class=n>schema_field</span><span class=o>.</span><span class=n>fields</span><span class=p>:</span>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>            <span class=k>if</span> <span class=n>field</span><span class=o>.</span><span class=n>mode</span> <span class=o>==</span> <span class=s2>&quot;REPEATED&quot;</span><span class=p>:</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>                <span class=k>if</span> <span class=n>field</span><span class=o>.</span><span class=n>field_type</span> <span class=o>==</span> <span class=s2>&quot;RECORD&quot;</span><span class=p>:</span>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>                    <span class=k>yield</span> <span class=n>field</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>ARRAY</span><span class=p>(</span><span class=n>struct_for_schema_field</span><span class=p>(</span><span class=n>field</span><span class=p>))</span>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>                <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>                    <span class=n>sqla_type</span> <span class=o>=</span> <span class=n>BIGQUERY_TYPES_TO_SQLALCHEMY_TYPES</span><span class=p>[</span><span class=n>field</span><span class=o>.</span><span class=n>field_type</span><span class=p>]</span>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a>                    <span class=k>yield</span> <span class=n>field</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>ARRAY</span><span class=p>(</span><span class=n>sqla_type</span><span class=p>)</span>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>            <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>                <span class=k>if</span> <span class=n>field</span><span class=o>.</span><span class=n>field_type</span> <span class=o>==</span> <span class=s2>&quot;RECORD&quot;</span><span class=p>:</span>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>                    <span class=k>yield</span> <span class=n>field</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>struct_for_schema_field</span><span class=p>(</span><span class=n>field</span><span class=p>)</span>
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a>                <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a>                    <span class=n>sqla_type</span> <span class=o>=</span> <span class=n>BIGQUERY_TYPES_TO_SQLALCHEMY_TYPES</span><span class=p>[</span><span class=n>field</span><span class=o>.</span><span class=n>field_type</span><span class=p>]</span>
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a>                    <span class=k>yield</span> <span class=n>field</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>sqla_type</span>
<a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a>
<a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a>    <span class=k>return</span> <span class=n>STRUCT</span><span class=p>(</span><span class=o>*</span><span class=n>fields</span><span class=p>())</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=amora.providers.bigquery.column_for_schema_field class="doc doc-heading"> <code class="highlight language-python"><span class=n>column_for_schema_field</span><span class=p>(</span><span class=n>schema</span><span class=p>:</span> <span class=n>SchemaField</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Field</span></code> <a href=#amora.providers.bigquery.column_for_schema_field class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <p>Build a <code>Column</code> from a <code>google.cloud.bigquery.schema.SchemaField</code></p> <p>Read more: https://cloud.google.com/bigquery/docs/reference/rest/v2/tables#tablefieldschema</p> <details class=quote> <summary>Source code in <code>amora/providers/bigquery.py</code></summary> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>def</span> <span class=nf>column_for_schema_field</span><span class=p>(</span><span class=n>schema</span><span class=p>:</span> <span class=n>SchemaField</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>dataclasses</span><span class=o>.</span><span class=n>Field</span><span class=p>:</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=sd>    Build a `Column` from a `google.cloud.bigquery.schema.SchemaField`</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=sd>    Read more: https://cloud.google.com/bigquery/docs/reference/rest/v2/tables#tablefieldschema</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>    <span class=k>if</span> <span class=n>schema</span><span class=o>.</span><span class=n>mode</span> <span class=o>==</span> <span class=s2>&quot;REPEATED&quot;</span><span class=p>:</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>        <span class=k>if</span> <span class=n>schema</span><span class=o>.</span><span class=n>field_type</span> <span class=o>==</span> <span class=s2>&quot;RECORD&quot;</span><span class=p>:</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>            <span class=n>column_type</span> <span class=o>=</span> <span class=n>ARRAY</span><span class=p>(</span><span class=n>struct_for_schema_field</span><span class=p>(</span><span class=n>schema</span><span class=p>))</span>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>            <span class=n>column_type</span> <span class=o>=</span> <span class=n>ARRAY</span><span class=p>(</span><span class=n>BIGQUERY_TYPES_TO_SQLALCHEMY_TYPES</span><span class=p>[</span><span class=n>schema</span><span class=o>.</span><span class=n>field_type</span><span class=p>])</span>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>        <span class=k>if</span> <span class=n>schema</span><span class=o>.</span><span class=n>field_type</span> <span class=o>==</span> <span class=s2>&quot;RECORD&quot;</span><span class=p>:</span>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>            <span class=n>column_type</span> <span class=o>=</span> <span class=n>struct_for_schema_field</span><span class=p>(</span><span class=n>schema</span><span class=p>)</span>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a>        <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>            <span class=n>column_type</span> <span class=o>=</span> <span class=n>BIGQUERY_TYPES_TO_SQLALCHEMY_TYPES</span><span class=p>[</span><span class=n>schema</span><span class=o>.</span><span class=n>field_type</span><span class=p>]</span>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>    <span class=k>return</span> <span class=n>Field</span><span class=p>(</span><span class=n>column_type</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 id=amora.providers.bigquery.schema_field_for_column class="doc doc-heading"> <code class="highlight language-python"><span class=n>schema_field_for_column</span><span class=p>(</span><span class=n>column</span><span class=p>:</span> <span class=n>Column</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>SchemaField</span></code> <a href=#amora.providers.bigquery.schema_field_for_column class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <details class=quote> <summary>Source code in <code>amora/providers/bigquery.py</code></summary> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>def</span> <span class=nf>schema_field_for_column</span><span class=p>(</span><span class=n>column</span><span class=p>:</span> <span class=n>Column</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>SchemaField</span><span class=p>:</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>    <span class=n>fields</span><span class=p>:</span> <span class=n>Iterable</span><span class=p>[</span><span class=n>SchemaField</span><span class=p>]</span> <span class=o>=</span> <span class=p>()</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>column</span><span class=o>.</span><span class=n>type</span><span class=p>,</span> <span class=n>ARRAY</span><span class=p>):</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>        <span class=n>mode</span> <span class=o>=</span> <span class=s2>&quot;REPEATED&quot;</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>        <span class=n>item_type</span> <span class=o>=</span> <span class=n>column</span><span class=o>.</span><span class=n>type</span><span class=o>.</span><span class=n>item_type</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>        <span class=n>field_type</span> <span class=o>=</span> <span class=n>SQLALCHEMY_TYPES_TO_BIGQUERY_TYPES</span><span class=p>[</span><span class=n>column</span><span class=o>.</span><span class=n>type</span><span class=o>.</span><span class=n>item_type</span><span class=o>.</span><span class=vm>__class__</span><span class=p>]</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>item_type</span><span class=p>,</span> <span class=n>STRUCT</span><span class=p>):</span>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>            <span class=n>fields</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span><span class=n>schema_for_struct</span><span class=p>(</span><span class=n>item_type</span><span class=p>))</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>    <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>        <span class=n>mode</span> <span class=o>=</span> <span class=s2>&quot;NULLABLE&quot;</span>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>        <span class=n>column_type</span> <span class=o>=</span> <span class=n>column</span><span class=o>.</span><span class=n>type</span>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>        <span class=n>field_type</span> <span class=o>=</span> <span class=n>SQLALCHEMY_TYPES_TO_BIGQUERY_TYPES</span><span class=p>[</span><span class=n>column_type</span><span class=o>.</span><span class=vm>__class__</span><span class=p>]</span>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>column_type</span><span class=p>,</span> <span class=n>STRUCT</span><span class=p>):</span>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>            <span class=n>fields</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span><span class=n>schema_for_struct</span><span class=p>(</span><span class=n>column_type</span><span class=p>))</span>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a>    <span class=k>return</span> <span class=n>SchemaField</span><span class=p>(</span>
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a>        <span class=n>name</span><span class=o>=</span><span class=n>column</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a>        <span class=n>field_type</span><span class=o>=</span><span class=n>field_type</span><span class=p>,</span>
<a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a>        <span class=n>mode</span><span class=o>=</span><span class=n>mode</span><span class=p>,</span>
<a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a>        <span class=n>fields</span><span class=o>=</span><span class=n>fields</span> <span class=ow>or</span> <span class=p>(),</span>
<a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a>        <span class=n>description</span><span class=o>=</span><span class=n>column</span><span class=o>.</span><span class=n>doc</span> <span class=ow>or</span> <span class=n>_DEFAULT_VALUE</span><span class=p>,</span>
<a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a>    <span class=p>)</span>
</code></pre></div> </details> </div> </div> <h2 id=data-sample>Data Sample<a class=headerlink href=#data-sample title="Permanent link">&para;</a></h2> <div class="doc doc-object doc-function"> <h3 id=amora.providers.bigquery.sample class="doc doc-heading"> <code class="highlight language-python"><span class=n>sample</span><span class=p>(</span><span class=n>model</span><span class=p>:</span> <span class=n>Type</span><span class=p>[</span><span class=n>AmoraModel</span><span class=p>],</span> <span class=n>percentage</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span> <span class=n>limit</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1000</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>DataFrame</span></code> <a href=#amora.providers.bigquery.sample class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <p>Given a model, returns a random sample of the data.</p> <p>Read more: <a href=https://cloud.google.com/bigquery/docs/table-sampling>https://cloud.google.com/bigquery/docs/table-sampling</a></p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>model</code></td> <td><code>Type[AmoraModel]</code></td> <td><p>AmoraModel to extract the extract the sample</p></td> <td><em>required</em></td> </tr> <tr> <td><code>percentage</code></td> <td><code>int</code></td> <td><p>The percentage of the sample. E.g: percentage=10 is 10% of the data.</p></td> <td><code>1</code></td> </tr> <tr> <td><code>limit</code></td> <td><code>int</code></td> <td><p>The maximum number of rows to be returned</p></td> <td><code>1000</code></td> </tr> </tbody> </table> <p><strong>Returns:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>DataFrame</code></td> <td><p>The sample data as a <code>pandas.DataFrame</code></p></td> </tr> </tbody> </table> <p><strong>Exceptions:</strong></p> <table> <thead> <tr> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>ValueError</code></td> <td><p>TABLESAMPLE SYSTEM can only be applied directly to tables.</p></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>amora/providers/bigquery.py</code></summary> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=nd>@cache</span><span class=p>(</span><span class=n>_sample_cache_key</span><span class=p>)</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=k>def</span> <span class=nf>sample</span><span class=p>(</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>    <span class=n>model</span><span class=p>:</span> <span class=n>Model</span><span class=p>,</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>    <span class=n>percentage</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>    <span class=n>limit</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=n>settings</span><span class=o>.</span><span class=n>GCP_BIGQUERY_DEFAULT_LIMIT_SIZE</span><span class=p>,</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>:</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=sd>    Given a model, returns a random sample of the data.</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=sd>    Read more: [https://cloud.google.com/bigquery/docs/table-sampling](https://cloud.google.com/bigquery/docs/table-sampling)</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=sd>    Args:</span>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=sd>        model: AmoraModel to extract the extract the sample</span>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=sd>        percentage: The percentage of the sample. E.g: percentage=10 is 10% of the data.</span>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a><span class=sd>        limit: The maximum number of rows to be returned</span>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a><span class=sd>    Returns:</span>
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a><span class=sd>        The sample data as a `pandas.DataFrame`</span>
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a><span class=sd>    Raises:</span>
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a><span class=sd>        ValueError: TABLESAMPLE SYSTEM can only be applied directly to tables.</span>
<a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a>    <span class=k>if</span> <span class=n>model</span><span class=o>.</span><span class=n>__model_config__</span><span class=o>.</span><span class=n>materialized</span> <span class=ow>is</span> <span class=ow>not</span> <span class=n>MaterializationTypes</span><span class=o>.</span><span class=n>table</span><span class=p>:</span>
<a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span>
<a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a>            <span class=s2>&quot;TABLESAMPLE SYSTEM can only be applied directly to tables. &quot;</span>
<a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a>            <span class=s2>&quot;More on: https://cloud.google.com/bigquery/docs/table-sampling#limitations&quot;</span>
<a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a>        <span class=p>)</span>
<a id=__codelineno-0-28 name=__codelineno-0-28 href=#__codelineno-0-28></a>
<a id=__codelineno-0-29 name=__codelineno-0-29 href=#__codelineno-0-29></a>    <span class=n>sampling</span> <span class=o>=</span> <span class=n>literal_column</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>percentage</span><span class=si>}</span><span class=s2> PERCENT&quot;</span><span class=p>)</span>
<a id=__codelineno-0-30 name=__codelineno-0-30 href=#__codelineno-0-30></a>    <span class=n>model_sample</span> <span class=o>=</span> <span class=n>tablesample</span><span class=p>(</span><span class=n>model</span><span class=p>,</span> <span class=n>sampling</span><span class=p>)</span>  <span class=c1># type: ignore</span>
<a id=__codelineno-0-31 name=__codelineno-0-31 href=#__codelineno-0-31></a>    <span class=n>stmt</span> <span class=o>=</span> <span class=n>select</span><span class=p>(</span><span class=n>model_sample</span><span class=p>)</span><span class=o>.</span><span class=n>limit</span><span class=p>(</span><span class=n>limit</span><span class=p>)</span>
<a id=__codelineno-0-32 name=__codelineno-0-32 href=#__codelineno-0-32></a>
<a id=__codelineno-0-33 name=__codelineno-0-33 href=#__codelineno-0-33></a>    <span class=n>logger</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Sampling model `</span><span class=si>{</span><span class=n>model</span><span class=o>.</span><span class=n>unique_name</span><span class=p>()</span><span class=si>}</span><span class=s2>`&quot;</span><span class=p>)</span>
<a id=__codelineno-0-34 name=__codelineno-0-34 href=#__codelineno-0-34></a>    <span class=k>return</span> <span class=n>run</span><span class=p>(</span><span class=n>stmt</span><span class=p>)</span><span class=o>.</span><span class=n>to_dataframe</span><span class=p>()</span>
</code></pre></div> </details> </div> </div> <h2 id=repeated-fields>Repeated Fields<a class=headerlink href=#repeated-fields title="Permanent link">&para;</a></h2> <p>Read more: <a href=https://cloud.google.com/bigquery/docs/nested-repeated>https://cloud.google.com/bigquery/docs/nested-repeated</a></p> <div class="doc doc-object doc-class"> <h3 id=amora.providers.bigquery.array class="doc doc-heading"> <code> array (<span title=sqlalchemy.sql.elements.ClauseList>ClauseList</span>, <span title=sqlalchemy.sql.elements.ColumnElement>ColumnElement</span>) </code> <a href=#amora.providers.bigquery.array class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <p>A BigQuery ARRAY literal.</p> <p>This is used to produce <code>ARRAY</code> literals in SQL expressions, e.g.:</p> <p><div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=kn>from</span> <span class=nn>sqlalchemy</span> <span class=kn>import</span> <span class=n>select</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=kn>from</span> <span class=nn>amora.compilation</span> <span class=kn>import</span> <span class=n>compile_statement</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=kn>from</span> <span class=nn>amora.providers.bigquery</span> <span class=kn>import</span> <span class=n>array</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=n>stmt</span> <span class=o>=</span> <span class=n>select</span><span class=p>([</span><span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>])</span><span class=o>.</span><span class=n>label</span><span class=p>(</span><span class=s2>&quot;a&quot;</span><span class=p>),</span> <span class=n>array</span><span class=p>([</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>])</span><span class=o>.</span><span class=n>label</span><span class=p>(</span><span class=s2>&quot;b&quot;</span><span class=p>)])</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=n>compile_statement</span><span class=p>(</span><span class=n>stmt</span><span class=p>)</span>
</code></pre></div> Produces the SQL:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=k>SELECT</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=w>    </span><span class=nb>ARRAY</span><span class=p>[</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>]</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>a</span><span class=p>,</span>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=w>    </span><span class=nb>ARRAY</span><span class=p>[</span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>4</span><span class=p>,</span><span class=w> </span><span class=mi>5</span><span class=p>])</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>b</span>
</code></pre></div> <p>An instance of <code>array</code> will always have the datatype <code>sqlalchemy_bigquery.base.BQArray</code>. The "inner" type of the array is inferred from the values present, unless the <code>type_</code> keyword argument is passed, e.g.:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=n>array</span><span class=p>([</span><span class=s2>&quot;foo&quot;</span><span class=p>,</span> <span class=s2>&quot;bar&quot;</span><span class=p>],</span> <span class=n>type_</span><span class=o>=</span><span class=n>String</span><span class=p>)</span>
</code></pre></div> <p>Arrays can also be constructed using <code>AmoraModel</code> instances, which would compile into a array of structs. E.g:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=k>class</span> <span class=nc>Point</span><span class=p>(</span><span class=n>AmoraModel</span><span class=p>):</span>
<a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>    <span class=n>x</span><span class=p>:</span> <span class=nb>int</span>
<a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>    <span class=n>y</span><span class=p>:</span> <span class=nb>int</span>
<a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>
<a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>
<a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a><span class=n>array</span><span class=p>([</span><span class=n>Point</span><span class=p>(</span><span class=n>x</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=mi>4</span><span class=p>),</span> <span class=n>Point</span><span class=p>(</span><span class=n>x</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>y</span><span class=o>=</span><span class=mi>2</span><span class=p>)])</span>
</code></pre></div> <details class=quote> <summary>Source code in <code>amora/providers/bigquery.py</code></summary> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>class</span> <span class=nc>array</span><span class=p>(</span><span class=n>expression</span><span class=o>.</span><span class=n>ClauseList</span><span class=p>,</span> <span class=n>expression</span><span class=o>.</span><span class=n>ColumnElement</span><span class=p>):</span>  <span class=c1># type: ignore</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=sd>    A BigQuery ARRAY literal.</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=sd>    This is used to produce `ARRAY` literals in SQL expressions, e.g.:</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=sd>    ```python</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=sd>    from sqlalchemy import select</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=sd>    from amora.compilation import compile_statement</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=sd>    from amora.providers.bigquery import array</span>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=sd>    stmt = select([array([1, 2]).label(&quot;a&quot;), array([3, 4, 5]).label(&quot;b&quot;)])</span>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=sd>    compile_statement(stmt)</span>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=sd>    ```</span>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a><span class=sd>    Produces the SQL:</span>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a><span class=sd>    ```sql</span>
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a><span class=sd>    SELECT</span>
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a><span class=sd>        ARRAY[1, 2] AS a,</span>
<a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a><span class=sd>        ARRAY[3, 4, 5]) AS b</span>
<a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a><span class=sd>    ```</span>
<a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a>
<a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a><span class=sd>    An instance of `array` will always have the datatype `sqlalchemy_bigquery.base.BQArray`.</span>
<a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a><span class=sd>    The &quot;inner&quot; type of the array is inferred from the values present, unless the</span>
<a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a><span class=sd>    ``type_`` keyword argument is passed, e.g.:</span>
<a id=__codelineno-0-28 name=__codelineno-0-28 href=#__codelineno-0-28></a>
<a id=__codelineno-0-29 name=__codelineno-0-29 href=#__codelineno-0-29></a><span class=sd>    ```python</span>
<a id=__codelineno-0-30 name=__codelineno-0-30 href=#__codelineno-0-30></a><span class=sd>    array([&quot;foo&quot;, &quot;bar&quot;], type_=String)</span>
<a id=__codelineno-0-31 name=__codelineno-0-31 href=#__codelineno-0-31></a><span class=sd>    ```</span>
<a id=__codelineno-0-32 name=__codelineno-0-32 href=#__codelineno-0-32></a>
<a id=__codelineno-0-33 name=__codelineno-0-33 href=#__codelineno-0-33></a><span class=sd>    Arrays can also be constructed using `AmoraModel` instances,</span>
<a id=__codelineno-0-34 name=__codelineno-0-34 href=#__codelineno-0-34></a><span class=sd>    which would compile into a array of structs. E.g:</span>
<a id=__codelineno-0-35 name=__codelineno-0-35 href=#__codelineno-0-35></a>
<a id=__codelineno-0-36 name=__codelineno-0-36 href=#__codelineno-0-36></a><span class=sd>    ```python</span>
<a id=__codelineno-0-37 name=__codelineno-0-37 href=#__codelineno-0-37></a><span class=sd>    class Point(AmoraModel):</span>
<a id=__codelineno-0-38 name=__codelineno-0-38 href=#__codelineno-0-38></a><span class=sd>        x: int</span>
<a id=__codelineno-0-39 name=__codelineno-0-39 href=#__codelineno-0-39></a><span class=sd>        y: int</span>
<a id=__codelineno-0-40 name=__codelineno-0-40 href=#__codelineno-0-40></a>
<a id=__codelineno-0-41 name=__codelineno-0-41 href=#__codelineno-0-41></a>
<a id=__codelineno-0-42 name=__codelineno-0-42 href=#__codelineno-0-42></a><span class=sd>    array([Point(x=4, y=4), Point(x=2, y=2)])</span>
<a id=__codelineno-0-43 name=__codelineno-0-43 href=#__codelineno-0-43></a><span class=sd>    ```</span>
<a id=__codelineno-0-44 name=__codelineno-0-44 href=#__codelineno-0-44></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-45 name=__codelineno-0-45 href=#__codelineno-0-45></a>
<a id=__codelineno-0-46 name=__codelineno-0-46 href=#__codelineno-0-46></a>    <span class=n>__visit_name__</span> <span class=o>=</span> <span class=s2>&quot;array&quot;</span>
<a id=__codelineno-0-47 name=__codelineno-0-47 href=#__codelineno-0-47></a>
<a id=__codelineno-0-48 name=__codelineno-0-48 href=#__codelineno-0-48></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>clauses</span><span class=p>,</span> <span class=o>**</span><span class=n>kw</span><span class=p>):</span>
<a id=__codelineno-0-49 name=__codelineno-0-49 href=#__codelineno-0-49></a>        <span class=k>if</span> <span class=n>clauses</span> <span class=ow>and</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>clauses</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>AmoraModel</span><span class=p>):</span>
<a id=__codelineno-0-50 name=__codelineno-0-50 href=#__codelineno-0-50></a>            <span class=n>clauses</span> <span class=o>=</span> <span class=p>[</span><span class=n>struct</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>clauses</span><span class=p>]</span>
<a id=__codelineno-0-51 name=__codelineno-0-51 href=#__codelineno-0-51></a>
<a id=__codelineno-0-52 name=__codelineno-0-52 href=#__codelineno-0-52></a>        <span class=n>clauses</span> <span class=o>=</span> <span class=p>[</span><span class=n>coercions</span><span class=o>.</span><span class=n>expect</span><span class=p>(</span><span class=n>roles</span><span class=o>.</span><span class=n>ExpressionElementRole</span><span class=p>,</span> <span class=n>c</span><span class=p>)</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>clauses</span><span class=p>]</span>
<a id=__codelineno-0-53 name=__codelineno-0-53 href=#__codelineno-0-53></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=o>*</span><span class=n>clauses</span><span class=p>,</span> <span class=o>**</span><span class=n>kw</span><span class=p>)</span>
<a id=__codelineno-0-54 name=__codelineno-0-54 href=#__codelineno-0-54></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_type_tuple</span> <span class=o>=</span> <span class=p>[</span><span class=n>arg</span><span class=o>.</span><span class=n>type</span> <span class=k>for</span> <span class=n>arg</span> <span class=ow>in</span> <span class=n>clauses</span><span class=p>]</span>
<a id=__codelineno-0-55 name=__codelineno-0-55 href=#__codelineno-0-55></a>        <span class=n>main_type</span> <span class=o>=</span> <span class=n>kw</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span>
<a id=__codelineno-0-56 name=__codelineno-0-56 href=#__codelineno-0-56></a>            <span class=s2>&quot;type_&quot;</span><span class=p>,</span>
<a id=__codelineno-0-57 name=__codelineno-0-57 href=#__codelineno-0-57></a>            <span class=bp>self</span><span class=o>.</span><span class=n>_type_tuple</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>_type_tuple</span> <span class=k>else</span> <span class=n>sqltypes</span><span class=o>.</span><span class=n>NULLTYPE</span><span class=p>,</span>
<a id=__codelineno-0-58 name=__codelineno-0-58 href=#__codelineno-0-58></a>        <span class=p>)</span>
<a id=__codelineno-0-59 name=__codelineno-0-59 href=#__codelineno-0-59></a>        <span class=bp>self</span><span class=o>.</span><span class=n>type</span> <span class=o>=</span> <span class=n>BQArray</span><span class=p>(</span><span class=n>main_type</span><span class=p>,</span> <span class=n>dimensions</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
<a id=__codelineno-0-60 name=__codelineno-0-60 href=#__codelineno-0-60></a>
<a id=__codelineno-0-61 name=__codelineno-0-61 href=#__codelineno-0-61></a>        <span class=k>for</span> <span class=n>type_</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>_type_tuple</span><span class=p>:</span>
<a id=__codelineno-0-62 name=__codelineno-0-62 href=#__codelineno-0-62></a>            <span class=k>if</span> <span class=nb>type</span><span class=p>(</span><span class=n>type_</span><span class=p>)</span> <span class=ow>is</span> <span class=n>sqltypes</span><span class=o>.</span><span class=n>NullType</span><span class=p>:</span>
<a id=__codelineno-0-63 name=__codelineno-0-63 href=#__codelineno-0-63></a>                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&quot;Array cannot have a null element&quot;</span><span class=p>)</span>
<a id=__codelineno-0-64 name=__codelineno-0-64 href=#__codelineno-0-64></a>
<a id=__codelineno-0-65 name=__codelineno-0-65 href=#__codelineno-0-65></a>    <span class=k>def</span> <span class=nf>_bind_param</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>operator</span><span class=p>,</span> <span class=n>obj</span><span class=p>,</span> <span class=n>_assume_scalar</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>type_</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<a id=__codelineno-0-66 name=__codelineno-0-66 href=#__codelineno-0-66></a>        <span class=k>if</span> <span class=n>_assume_scalar</span> <span class=ow>or</span> <span class=n>operator</span> <span class=ow>is</span> <span class=n>operators</span><span class=o>.</span><span class=n>getitem</span><span class=p>:</span>
<a id=__codelineno-0-67 name=__codelineno-0-67 href=#__codelineno-0-67></a>            <span class=c1># if getitem-&gt;slice were called, Indexable produces</span>
<a id=__codelineno-0-68 name=__codelineno-0-68 href=#__codelineno-0-68></a>            <span class=c1># a Slice object from that</span>
<a id=__codelineno-0-69 name=__codelineno-0-69 href=#__codelineno-0-69></a>            <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>obj</span><span class=p>,</span> <span class=nb>int</span><span class=p>)</span>
<a id=__codelineno-0-70 name=__codelineno-0-70 href=#__codelineno-0-70></a>            <span class=k>return</span> <span class=n>expression</span><span class=o>.</span><span class=n>BindParameter</span><span class=p>(</span>
<a id=__codelineno-0-71 name=__codelineno-0-71 href=#__codelineno-0-71></a>                <span class=kc>None</span><span class=p>,</span>
<a id=__codelineno-0-72 name=__codelineno-0-72 href=#__codelineno-0-72></a>                <span class=n>obj</span><span class=p>,</span>
<a id=__codelineno-0-73 name=__codelineno-0-73 href=#__codelineno-0-73></a>                <span class=n>_compared_to_operator</span><span class=o>=</span><span class=n>operator</span><span class=p>,</span>
<a id=__codelineno-0-74 name=__codelineno-0-74 href=#__codelineno-0-74></a>                <span class=n>type_</span><span class=o>=</span><span class=n>type_</span><span class=p>,</span>
<a id=__codelineno-0-75 name=__codelineno-0-75 href=#__codelineno-0-75></a>                <span class=n>_compared_to_type</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>type</span><span class=p>,</span>
<a id=__codelineno-0-76 name=__codelineno-0-76 href=#__codelineno-0-76></a>                <span class=n>unique</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
<a id=__codelineno-0-77 name=__codelineno-0-77 href=#__codelineno-0-77></a>            <span class=p>)</span>
<a id=__codelineno-0-78 name=__codelineno-0-78 href=#__codelineno-0-78></a>
<a id=__codelineno-0-79 name=__codelineno-0-79 href=#__codelineno-0-79></a>        <span class=k>return</span> <span class=n>array</span><span class=p>(</span>
<a id=__codelineno-0-80 name=__codelineno-0-80 href=#__codelineno-0-80></a>            <span class=p>[</span>
<a id=__codelineno-0-81 name=__codelineno-0-81 href=#__codelineno-0-81></a>                <span class=bp>self</span><span class=o>.</span><span class=n>_bind_param</span><span class=p>(</span><span class=n>operator</span><span class=p>,</span> <span class=n>o</span><span class=p>,</span> <span class=n>_assume_scalar</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>type_</span><span class=o>=</span><span class=n>type_</span><span class=p>)</span>
<a id=__codelineno-0-82 name=__codelineno-0-82 href=#__codelineno-0-82></a>                <span class=k>for</span> <span class=n>o</span> <span class=ow>in</span> <span class=n>obj</span>
<a id=__codelineno-0-83 name=__codelineno-0-83 href=#__codelineno-0-83></a>            <span class=p>]</span>
<a id=__codelineno-0-84 name=__codelineno-0-84 href=#__codelineno-0-84></a>        <span class=p>)</span>
<a id=__codelineno-0-85 name=__codelineno-0-85 href=#__codelineno-0-85></a>
<a id=__codelineno-0-86 name=__codelineno-0-86 href=#__codelineno-0-86></a>    <span class=k>def</span> <span class=nf>self_group</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>against</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<a id=__codelineno-0-87 name=__codelineno-0-87 href=#__codelineno-0-87></a>        <span class=k>if</span> <span class=n>against</span> <span class=ow>in</span> <span class=p>(</span><span class=n>operators</span><span class=o>.</span><span class=n>any_op</span><span class=p>,</span> <span class=n>operators</span><span class=o>.</span><span class=n>all_op</span><span class=p>,</span> <span class=n>operators</span><span class=o>.</span><span class=n>getitem</span><span class=p>):</span>
<a id=__codelineno-0-88 name=__codelineno-0-88 href=#__codelineno-0-88></a>            <span class=k>return</span> <span class=n>expression</span><span class=o>.</span><span class=n>Grouping</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
<a id=__codelineno-0-89 name=__codelineno-0-89 href=#__codelineno-0-89></a>
<a id=__codelineno-0-90 name=__codelineno-0-90 href=#__codelineno-0-90></a>        <span class=k>return</span> <span class=bp>self</span>
</code></pre></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-method"> <h4 id=amora.providers.bigquery.array.self_group class="doc doc-heading"> <code class="highlight language-python"><span class=n>self_group</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>against</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span></code> <a href=#amora.providers.bigquery.array.self_group class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>Apply a 'grouping' to this :class:<code>_expression.ClauseElement</code>.</p> <p>This method is overridden by subclasses to return a "grouping" construct, i.e. parenthesis. In particular it's used by "binary" expressions to provide a grouping around themselves when placed into a larger expression, as well as by :func:<code>_expression.select</code> constructs when placed into the FROM clause of another :func:<code>_expression.select</code>. (Note that subqueries should be normally created using the :meth:<code>_expression.Select.alias</code> method, as many platforms require nested SELECT statements to be named).</p> <p>As expressions are composed together, the application of :meth:<code>self_group</code> is automatic - end-user code should never need to use this method directly. Note that SQLAlchemy's clause constructs take operator precedence into account - so parenthesis might not be needed, for example, in an expression like <code>x OR (y AND z)</code> - AND takes precedence over OR.</p> <p>The base :meth:<code>self_group</code> method of :class:<code>_expression.ClauseElement</code> just returns self.</p> <details class=quote> <summary>Source code in <code>amora/providers/bigquery.py</code></summary> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>def</span> <span class=nf>self_group</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>against</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>    <span class=k>if</span> <span class=n>against</span> <span class=ow>in</span> <span class=p>(</span><span class=n>operators</span><span class=o>.</span><span class=n>any_op</span><span class=p>,</span> <span class=n>operators</span><span class=o>.</span><span class=n>all_op</span><span class=p>,</span> <span class=n>operators</span><span class=o>.</span><span class=n>getitem</span><span class=p>):</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>        <span class=k>return</span> <span class=n>expression</span><span class=o>.</span><span class=n>Grouping</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>    <span class=k>return</span> <span class=bp>self</span>
</code></pre></div> </details> </div> </div> </div> </div> </div> <h3 id=zipping-arrays>Zipping arrays<a class=headerlink href=#zipping-arrays title="Permanent link">&para;</a></h3> <div class="doc doc-object doc-function"> <h4 id=amora.providers.bigquery.zip_arrays class="doc doc-heading"> <code class="highlight language-python"><span class=n>zip_arrays</span><span class=p>(</span><span class=o>*</span><span class=n>arr_columns</span><span class=p>:</span> <span class=n>Column</span><span class=p>,</span> <span class=o>*</span><span class=p>,</span> <span class=n>additional_columns</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>sqlalchemy</span><span class=o>.</span><span class=n>sql</span><span class=o>.</span><span class=n>schema</span><span class=o>.</span><span class=n>Column</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Union</span><span class=p>[</span><span class=n>sqlalchemy</span><span class=o>.</span><span class=n>sql</span><span class=o>.</span><span class=n>selectable</span><span class=o>.</span><span class=n>Select</span><span class=p>,</span> <span class=n>sqlalchemy</span><span class=o>.</span><span class=n>sql</span><span class=o>.</span><span class=n>selectable</span><span class=o>.</span><span class=n>Selectable</span><span class=p>]</span></code> <a href=#amora.providers.bigquery.zip_arrays class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents first"> <p>Given at least two array columns of equal length, returns a table of the unnest values, converting array items into rows. E.g:</p> <p>A CTE with 3 array columns: <code>entity</code>, <code>f1</code>, <code>f2</code></p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=kn>from</span> <span class=nn>amora.providers.bigquery</span> <span class=kn>import</span> <span class=n>array</span><span class=p>,</span> <span class=n>cte_from_rows</span><span class=p>,</span> <span class=n>zip_arrays</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=n>cte</span> <span class=o>=</span> <span class=n>cte_from_rows</span><span class=p>(</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>    <span class=p>[</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>        <span class=p>{</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>            <span class=s2>&quot;entity&quot;</span><span class=p>:</span> <span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>]),</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>            <span class=s2>&quot;f1&quot;</span><span class=p>:</span> <span class=n>array</span><span class=p>([</span><span class=s2>&quot;f1v1&quot;</span><span class=p>,</span> <span class=s2>&quot;f1v2&quot;</span><span class=p>]),</span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>            <span class=s2>&quot;f2&quot;</span><span class=p>:</span> <span class=n>array</span><span class=p>([</span><span class=s2>&quot;f2v1&quot;</span><span class=p>,</span> <span class=s2>&quot;f2v2&quot;</span><span class=p>]),</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>        <span class=p>}</span>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>    <span class=p>]</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=p>)</span>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=n>zip_arrays</span><span class=p>(</span><span class=n>cte</span><span class=o>.</span><span class=n>c</span><span class=o>.</span><span class=n>entity</span><span class=p>,</span> <span class=n>cte</span><span class=o>.</span><span class=n>c</span><span class=o>.</span><span class=n>f1</span><span class=p>,</span> <span class=n>cte</span><span class=o>.</span><span class=n>c</span><span class=o>.</span><span class=n>f2</span><span class=p>)</span>
</code></pre></div> <p>Will result in the following table:</p> <table> <thead> <tr> <th>entity</th> <th>f1</th> <th>f2</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>f1v1</td> <td>f2v1</td> </tr> <tr> <td>2</td> <td>f1v2</td> <td>f2v2</td> </tr> </tbody> </table> <p>If additional columns are needed from the original data, those can be selected using the optional <code>additional_columns</code>:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=kn>from</span> <span class=nn>amora.providers.bigquery</span> <span class=kn>import</span> <span class=n>array</span><span class=p>,</span> <span class=n>cte_from_rows</span><span class=p>,</span> <span class=n>zip_arrays</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=n>cte</span> <span class=o>=</span> <span class=n>cte_from_rows</span><span class=p>(</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>    <span class=p>[</span>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>        <span class=p>{</span>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>            <span class=s2>&quot;entity&quot;</span><span class=p>:</span> <span class=n>array</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>]),</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>            <span class=s2>&quot;f1&quot;</span><span class=p>:</span> <span class=n>array</span><span class=p>([</span><span class=s2>&quot;f1v1&quot;</span><span class=p>,</span> <span class=s2>&quot;f1v2&quot;</span><span class=p>]),</span>
<a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>            <span class=s2>&quot;f2&quot;</span><span class=p>:</span> <span class=n>array</span><span class=p>([</span><span class=s2>&quot;f2v1&quot;</span><span class=p>,</span> <span class=s2>&quot;f2v2&quot;</span><span class=p>]),</span>
<a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a>            <span class=s2>&quot;id&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
<a id=__codelineno-1-10 name=__codelineno-1-10 href=#__codelineno-1-10></a>        <span class=p>},</span>
<a id=__codelineno-1-11 name=__codelineno-1-11 href=#__codelineno-1-11></a>        <span class=p>{</span>
<a id=__codelineno-1-12 name=__codelineno-1-12 href=#__codelineno-1-12></a>            <span class=s2>&quot;entity&quot;</span><span class=p>:</span> <span class=n>array</span><span class=p>([</span><span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>]),</span>
<a id=__codelineno-1-13 name=__codelineno-1-13 href=#__codelineno-1-13></a>            <span class=s2>&quot;f1&quot;</span><span class=p>:</span> <span class=n>array</span><span class=p>([</span><span class=s2>&quot;f1v3&quot;</span><span class=p>,</span> <span class=s2>&quot;f1v4&quot;</span><span class=p>]),</span>
<a id=__codelineno-1-14 name=__codelineno-1-14 href=#__codelineno-1-14></a>            <span class=s2>&quot;f2&quot;</span><span class=p>:</span> <span class=n>array</span><span class=p>([</span><span class=s2>&quot;f2v3&quot;</span><span class=p>,</span> <span class=s2>&quot;f2v4&quot;</span><span class=p>]),</span>
<a id=__codelineno-1-15 name=__codelineno-1-15 href=#__codelineno-1-15></a>            <span class=s2>&quot;id&quot;</span><span class=p>:</span> <span class=mi>2</span><span class=p>,</span>
<a id=__codelineno-1-16 name=__codelineno-1-16 href=#__codelineno-1-16></a>        <span class=p>},</span>
<a id=__codelineno-1-17 name=__codelineno-1-17 href=#__codelineno-1-17></a>    <span class=p>]</span>
<a id=__codelineno-1-18 name=__codelineno-1-18 href=#__codelineno-1-18></a><span class=p>)</span>
<a id=__codelineno-1-19 name=__codelineno-1-19 href=#__codelineno-1-19></a>
<a id=__codelineno-1-20 name=__codelineno-1-20 href=#__codelineno-1-20></a><span class=n>zip_arrays</span><span class=p>(</span><span class=n>cte</span><span class=o>.</span><span class=n>c</span><span class=o>.</span><span class=n>entity</span><span class=p>,</span> <span class=n>cte</span><span class=o>.</span><span class=n>c</span><span class=o>.</span><span class=n>f1</span><span class=p>,</span> <span class=n>cte</span><span class=o>.</span><span class=n>c</span><span class=o>.</span><span class=n>f2</span><span class=p>,</span> <span class=n>additional_columns</span><span class=o>=</span><span class=p>[</span><span class=n>cte</span><span class=o>.</span><span class=n>c</span><span class=o>.</span><span class=n>id</span><span class=p>])</span>
</code></pre></div> <table> <thead> <tr> <th>entity</th> <th>f1</th> <th>f2</th> <th>id</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>f1v1</td> <td>f2v1</td> <td>1</td> </tr> <tr> <td>2</td> <td>f1v2</td> <td>f2v2</td> <td>1</td> </tr> <tr> <td>3</td> <td>f1v3</td> <td>f2v3</td> <td>2</td> </tr> <tr> <td>4</td> <td>f1v4</td> <td>f2v4</td> <td>2</td> </tr> </tbody> </table> <p>Read more: <a href=https://cloud.google.com/bigquery/docs/reference/standard-sql/arrays#zipping_arrays>https://cloud.google.com/bigquery/docs/reference/standard-sql/arrays#zipping_arrays</a></p> <p><strong>Parameters:</strong></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr> <td><code>*arr_columns</code></td> <td><code>Column</code></td> <td><p>Array columns of equal length</p></td> <td><code>()</code></td> </tr> <tr> <td><code>additional_columns</code></td> <td><code>Optional[List[sqlalchemy.sql.schema.Column]]</code></td> <td><p>Additional columns needed from the original data</p></td> <td><code>None</code></td> </tr> </tbody> </table> <details class=quote> <summary>Source code in <code>amora/providers/bigquery.py</code></summary> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>def</span> <span class=nf>zip_arrays</span><span class=p>(</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>    <span class=o>*</span><span class=n>arr_columns</span><span class=p>:</span> <span class=n>Column</span><span class=p>,</span> <span class=n>additional_columns</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>Column</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Compilable</span><span class=p>:</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=sd>    Given at least two array columns of equal length, returns a table of the unnest values,</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=sd>    converting array items into rows. E.g:</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=sd>    A CTE with 3 array columns: `entity`, `f1`, `f2`</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=sd>    ```python</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=sd>    from amora.providers.bigquery import array, cte_from_rows, zip_arrays</span>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=sd>    cte = cte_from_rows(</span>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=sd>        [</span>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=sd>            {</span>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=sd>                &quot;entity&quot;: array([1, 2]),</span>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a><span class=sd>                &quot;f1&quot;: array([&quot;f1v1&quot;, &quot;f1v2&quot;]),</span>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a><span class=sd>                &quot;f2&quot;: array([&quot;f2v1&quot;, &quot;f2v2&quot;]),</span>
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a><span class=sd>            }</span>
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a><span class=sd>        ]</span>
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a><span class=sd>    )</span>
<a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a>
<a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a><span class=sd>    zip_arrays(cte.c.entity, cte.c.f1, cte.c.f2)</span>
<a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a><span class=sd>    ```</span>
<a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a>
<a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a><span class=sd>    Will result in the following table:</span>
<a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a>
<a id=__codelineno-0-28 name=__codelineno-0-28 href=#__codelineno-0-28></a><span class=sd>    | entity | f1   | f2   |</span>
<a id=__codelineno-0-29 name=__codelineno-0-29 href=#__codelineno-0-29></a><span class=sd>    |--------|------|------|</span>
<a id=__codelineno-0-30 name=__codelineno-0-30 href=#__codelineno-0-30></a><span class=sd>    | 1      | f1v1 | f2v1 |</span>
<a id=__codelineno-0-31 name=__codelineno-0-31 href=#__codelineno-0-31></a><span class=sd>    | 2      | f1v2 | f2v2 |</span>
<a id=__codelineno-0-32 name=__codelineno-0-32 href=#__codelineno-0-32></a>
<a id=__codelineno-0-33 name=__codelineno-0-33 href=#__codelineno-0-33></a><span class=sd>    If additional columns are needed from the original data, those can be selected</span>
<a id=__codelineno-0-34 name=__codelineno-0-34 href=#__codelineno-0-34></a><span class=sd>    using the optional `additional_columns`:</span>
<a id=__codelineno-0-35 name=__codelineno-0-35 href=#__codelineno-0-35></a>
<a id=__codelineno-0-36 name=__codelineno-0-36 href=#__codelineno-0-36></a><span class=sd>    ```python</span>
<a id=__codelineno-0-37 name=__codelineno-0-37 href=#__codelineno-0-37></a><span class=sd>    from amora.providers.bigquery import array, cte_from_rows, zip_arrays</span>
<a id=__codelineno-0-38 name=__codelineno-0-38 href=#__codelineno-0-38></a>
<a id=__codelineno-0-39 name=__codelineno-0-39 href=#__codelineno-0-39></a><span class=sd>    cte = cte_from_rows(</span>
<a id=__codelineno-0-40 name=__codelineno-0-40 href=#__codelineno-0-40></a><span class=sd>        [</span>
<a id=__codelineno-0-41 name=__codelineno-0-41 href=#__codelineno-0-41></a><span class=sd>            {</span>
<a id=__codelineno-0-42 name=__codelineno-0-42 href=#__codelineno-0-42></a><span class=sd>                &quot;entity&quot;: array([1, 2]),</span>
<a id=__codelineno-0-43 name=__codelineno-0-43 href=#__codelineno-0-43></a><span class=sd>                &quot;f1&quot;: array([&quot;f1v1&quot;, &quot;f1v2&quot;]),</span>
<a id=__codelineno-0-44 name=__codelineno-0-44 href=#__codelineno-0-44></a><span class=sd>                &quot;f2&quot;: array([&quot;f2v1&quot;, &quot;f2v2&quot;]),</span>
<a id=__codelineno-0-45 name=__codelineno-0-45 href=#__codelineno-0-45></a><span class=sd>                &quot;id&quot;: 1,</span>
<a id=__codelineno-0-46 name=__codelineno-0-46 href=#__codelineno-0-46></a><span class=sd>            },</span>
<a id=__codelineno-0-47 name=__codelineno-0-47 href=#__codelineno-0-47></a><span class=sd>            {</span>
<a id=__codelineno-0-48 name=__codelineno-0-48 href=#__codelineno-0-48></a><span class=sd>                &quot;entity&quot;: array([3, 4]),</span>
<a id=__codelineno-0-49 name=__codelineno-0-49 href=#__codelineno-0-49></a><span class=sd>                &quot;f1&quot;: array([&quot;f1v3&quot;, &quot;f1v4&quot;]),</span>
<a id=__codelineno-0-50 name=__codelineno-0-50 href=#__codelineno-0-50></a><span class=sd>                &quot;f2&quot;: array([&quot;f2v3&quot;, &quot;f2v4&quot;]),</span>
<a id=__codelineno-0-51 name=__codelineno-0-51 href=#__codelineno-0-51></a><span class=sd>                &quot;id&quot;: 2,</span>
<a id=__codelineno-0-52 name=__codelineno-0-52 href=#__codelineno-0-52></a><span class=sd>            },</span>
<a id=__codelineno-0-53 name=__codelineno-0-53 href=#__codelineno-0-53></a><span class=sd>        ]</span>
<a id=__codelineno-0-54 name=__codelineno-0-54 href=#__codelineno-0-54></a><span class=sd>    )</span>
<a id=__codelineno-0-55 name=__codelineno-0-55 href=#__codelineno-0-55></a>
<a id=__codelineno-0-56 name=__codelineno-0-56 href=#__codelineno-0-56></a><span class=sd>    zip_arrays(cte.c.entity, cte.c.f1, cte.c.f2, additional_columns=[cte.c.id])</span>
<a id=__codelineno-0-57 name=__codelineno-0-57 href=#__codelineno-0-57></a><span class=sd>    ```</span>
<a id=__codelineno-0-58 name=__codelineno-0-58 href=#__codelineno-0-58></a>
<a id=__codelineno-0-59 name=__codelineno-0-59 href=#__codelineno-0-59></a><span class=sd>    | entity | f1   | f2   | id   |</span>
<a id=__codelineno-0-60 name=__codelineno-0-60 href=#__codelineno-0-60></a><span class=sd>    |--------|------|------|------|</span>
<a id=__codelineno-0-61 name=__codelineno-0-61 href=#__codelineno-0-61></a><span class=sd>    | 1      | f1v1 | f2v1 | 1    |</span>
<a id=__codelineno-0-62 name=__codelineno-0-62 href=#__codelineno-0-62></a><span class=sd>    | 2      | f1v2 | f2v2 | 1    |</span>
<a id=__codelineno-0-63 name=__codelineno-0-63 href=#__codelineno-0-63></a><span class=sd>    | 3      | f1v3 | f2v3 | 2    |</span>
<a id=__codelineno-0-64 name=__codelineno-0-64 href=#__codelineno-0-64></a><span class=sd>    | 4      | f1v4 | f2v4 | 2    |</span>
<a id=__codelineno-0-65 name=__codelineno-0-65 href=#__codelineno-0-65></a>
<a id=__codelineno-0-66 name=__codelineno-0-66 href=#__codelineno-0-66></a><span class=sd>    Read more: [https://cloud.google.com/bigquery/docs/reference/standard-sql/arrays#zipping_arrays](https://cloud.google.com/bigquery/docs/reference/standard-sql/arrays#zipping_arrays)</span>
<a id=__codelineno-0-67 name=__codelineno-0-67 href=#__codelineno-0-67></a>
<a id=__codelineno-0-68 name=__codelineno-0-68 href=#__codelineno-0-68></a><span class=sd>    Args:</span>
<a id=__codelineno-0-69 name=__codelineno-0-69 href=#__codelineno-0-69></a><span class=sd>        *arr_columns: Array columns of equal length</span>
<a id=__codelineno-0-70 name=__codelineno-0-70 href=#__codelineno-0-70></a><span class=sd>        additional_columns: Additional columns needed from the original data</span>
<a id=__codelineno-0-71 name=__codelineno-0-71 href=#__codelineno-0-71></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-72 name=__codelineno-0-72 href=#__codelineno-0-72></a>    <span class=n>offset_alias</span> <span class=o>=</span> <span class=s2>&quot;off&quot;</span>
<a id=__codelineno-0-73 name=__codelineno-0-73 href=#__codelineno-0-73></a>    <span class=n>offset</span> <span class=o>=</span> <span class=n>func</span><span class=o>.</span><span class=n>offset</span><span class=p>(</span><span class=n>literal_column</span><span class=p>(</span><span class=n>offset_alias</span><span class=p>))</span>
<a id=__codelineno-0-74 name=__codelineno-0-74 href=#__codelineno-0-74></a>
<a id=__codelineno-0-75 name=__codelineno-0-75 href=#__codelineno-0-75></a>    <span class=n>columns</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>ColumnElement</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=n>col</span><span class=p>[</span><span class=n>offset</span><span class=p>]</span><span class=o>.</span><span class=n>label</span><span class=p>(</span><span class=n>col</span><span class=o>.</span><span class=n>key</span><span class=p>)</span> <span class=k>for</span> <span class=n>col</span> <span class=ow>in</span> <span class=n>arr_columns</span><span class=p>]</span>
<a id=__codelineno-0-76 name=__codelineno-0-76 href=#__codelineno-0-76></a>    <span class=k>if</span> <span class=n>additional_columns</span><span class=p>:</span>
<a id=__codelineno-0-77 name=__codelineno-0-77 href=#__codelineno-0-77></a>        <span class=n>columns</span> <span class=o>+=</span> <span class=n>additional_columns</span>
<a id=__codelineno-0-78 name=__codelineno-0-78 href=#__codelineno-0-78></a>
<a id=__codelineno-0-79 name=__codelineno-0-79 href=#__codelineno-0-79></a>    <span class=k>return</span> <span class=n>select</span><span class=p>(</span><span class=o>*</span><span class=n>columns</span><span class=p>)</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
<a id=__codelineno-0-80 name=__codelineno-0-80 href=#__codelineno-0-80></a>        <span class=n>fixed_unnest</span><span class=p>(</span><span class=n>arr_columns</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=o>.</span><span class=n>table_valued</span><span class=p>(</span><span class=n>with_offset</span><span class=o>=</span><span class=n>offset_alias</span><span class=p>),</span>
<a id=__codelineno-0-81 name=__codelineno-0-81 href=#__codelineno-0-81></a>        <span class=n>onclause</span><span class=o>=</span><span class=n>literal</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=o>==</span> <span class=n>literal</span><span class=p>(</span><span class=mi>1</span><span class=p>),</span>
<a id=__codelineno-0-82 name=__codelineno-0-82 href=#__codelineno-0-82></a>        <span class=n>isouter</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
<a id=__codelineno-0-83 name=__codelineno-0-83 href=#__codelineno-0-83></a>    <span class=p>)</span>
</code></pre></div> </details> </div> </div> <h2 id=structs-and-nested-models>Structs and Nested Models<a class=headerlink href=#structs-and-nested-models title="Permanent link">&para;</a></h2> <div class="doc doc-object doc-class"> <h3 id=amora.providers.bigquery.struct class="doc doc-heading"> <code> struct (<span title=sqlalchemy.sql.elements.ClauseList>ClauseList</span>, <span title=sqlalchemy.sql.elements.ColumnElement>ColumnElement</span>) </code> <a href=#amora.providers.bigquery.struct class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <p>A BigQuery STRUCT/RECORD literal.</p> <div class="admonition warning"> <p class=admonition-title>Experimental feature. You should probably use struct_for_model</p> </div> <details class=quote> <summary>Source code in <code>amora/providers/bigquery.py</code></summary> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>class</span> <span class=nc>struct</span><span class=p>(</span><span class=n>expression</span><span class=o>.</span><span class=n>ClauseList</span><span class=p>,</span> <span class=n>expression</span><span class=o>.</span><span class=n>ColumnElement</span><span class=p>):</span>  <span class=c1># type: ignore</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=sd>    A BigQuery STRUCT/RECORD literal.</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=sd>    !!! warning &quot;Experimental feature. You should probably use struct_for_model&quot;</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>    <span class=n>__visit_name__</span> <span class=o>=</span> <span class=s2>&quot;struct&quot;</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>model</span><span class=p>:</span> <span class=n>AmoraModel</span><span class=p>,</span> <span class=o>**</span><span class=n>kw</span><span class=p>):</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>        <span class=bp>self</span><span class=o>.</span><span class=n>_model</span> <span class=o>=</span> <span class=n>model</span>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>        <span class=bp>self</span><span class=o>.</span><span class=n>type</span> <span class=o>=</span> <span class=n>struct_for_model</span><span class=p>(</span><span class=n>model</span><span class=p>)</span>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>        <span class=n>clauses</span> <span class=o>=</span> <span class=p>[</span>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>            <span class=n>coercions</span><span class=o>.</span><span class=n>expect</span><span class=p>(</span>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a>                <span class=n>roles</span><span class=o>.</span><span class=n>ExpressionElementRole</span><span class=p>,</span>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>                <span class=n>dataclasses</span><span class=o>.</span><span class=n>asdict</span><span class=p>(</span><span class=n>model</span><span class=p>),</span>  <span class=c1># type: ignore</span>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>                <span class=n>type_</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>type</span><span class=p>,</span>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>            <span class=p>)</span>
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a>        <span class=p>]</span>
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=o>*</span><span class=n>clauses</span><span class=p>,</span> <span class=o>**</span><span class=n>kw</span><span class=p>)</span>
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a>
<a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a>    <span class=k>def</span> <span class=nf>bind_expression</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>bindvalue</span><span class=p>):</span>
<a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a>        <span class=k>return</span> <span class=n>bindvalue</span>
<a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a>
<a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a>    <span class=k>def</span> <span class=nf>self_group</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>against</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a>        <span class=k>if</span> <span class=n>against</span> <span class=ow>in</span> <span class=p>(</span><span class=n>operators</span><span class=o>.</span><span class=n>any_op</span><span class=p>,</span> <span class=n>operators</span><span class=o>.</span><span class=n>all_op</span><span class=p>,</span> <span class=n>operators</span><span class=o>.</span><span class=n>getitem</span><span class=p>):</span>
<a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a>            <span class=k>return</span> <span class=n>expression</span><span class=o>.</span><span class=n>Grouping</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
<a id=__codelineno-0-28 name=__codelineno-0-28 href=#__codelineno-0-28></a>
<a id=__codelineno-0-29 name=__codelineno-0-29 href=#__codelineno-0-29></a>        <span class=k>return</span> <span class=bp>self</span>
</code></pre></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-method"> <h4 id=amora.providers.bigquery.struct.self_group class="doc doc-heading"> <code class="highlight language-python"><span class=n>self_group</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>against</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span></code> <a href=#amora.providers.bigquery.struct.self_group class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>Apply a 'grouping' to this :class:<code>_expression.ClauseElement</code>.</p> <p>This method is overridden by subclasses to return a "grouping" construct, i.e. parenthesis. In particular it's used by "binary" expressions to provide a grouping around themselves when placed into a larger expression, as well as by :func:<code>_expression.select</code> constructs when placed into the FROM clause of another :func:<code>_expression.select</code>. (Note that subqueries should be normally created using the :meth:<code>_expression.Select.alias</code> method, as many platforms require nested SELECT statements to be named).</p> <p>As expressions are composed together, the application of :meth:<code>self_group</code> is automatic - end-user code should never need to use this method directly. Note that SQLAlchemy's clause constructs take operator precedence into account - so parenthesis might not be needed, for example, in an expression like <code>x OR (y AND z)</code> - AND takes precedence over OR.</p> <p>The base :meth:<code>self_group</code> method of :class:<code>_expression.ClauseElement</code> just returns self.</p> <details class=quote> <summary>Source code in <code>amora/providers/bigquery.py</code></summary> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>def</span> <span class=nf>self_group</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>against</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>    <span class=k>if</span> <span class=n>against</span> <span class=ow>in</span> <span class=p>(</span><span class=n>operators</span><span class=o>.</span><span class=n>any_op</span><span class=p>,</span> <span class=n>operators</span><span class=o>.</span><span class=n>all_op</span><span class=p>,</span> <span class=n>operators</span><span class=o>.</span><span class=n>getitem</span><span class=p>):</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>        <span class=k>return</span> <span class=n>expression</span><span class=o>.</span><span class=n>Grouping</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>    <span class=k>return</span> <span class=bp>self</span>
</code></pre></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-function"> <h3 id=amora.providers.bigquery.struct_for_model class="doc doc-heading"> <code class="highlight language-python"><span class=n>struct_for_model</span><span class=p>(</span><span class=n>model</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Type</span><span class=p>[</span><span class=n>AmoraModel</span><span class=p>],</span> <span class=n>amora</span><span class=o>.</span><span class=n>models</span><span class=o>.</span><span class=n>AmoraModel</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>STRUCT</span></code> <a href=#amora.providers.bigquery.struct_for_model class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents first"> <p>Build a BigQuery Struct type from an AmoraModel specification</p> <p>Read more: https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types#struct_type</p> <details class=quote> <summary>Source code in <code>amora/providers/bigquery.py</code></summary> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>def</span> <span class=nf>struct_for_model</span><span class=p>(</span><span class=n>model</span><span class=p>:</span> <span class=n>Union</span><span class=p>[</span><span class=n>Model</span><span class=p>,</span> <span class=n>AmoraModel</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>STRUCT</span><span class=p>:</span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;</span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=sd>    Build a BigQuery Struct type from an AmoraModel specification</span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=sd>    Read more: https://cloud.google.com/bigquery/docs/reference/standard-sql/data-types#struct_type</span>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=sd>    &quot;&quot;&quot;</span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>    <span class=k>def</span> <span class=nf>fields</span><span class=p>():</span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>        <span class=k>for</span> <span class=n>field</span> <span class=ow>in</span> <span class=n>dataclasses</span><span class=o>.</span><span class=n>fields</span><span class=p>(</span><span class=n>model</span><span class=p>):</span>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a>            <span class=k>if</span> <span class=n>field</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=nb>list</span><span class=p>:</span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>                <span class=k>if</span> <span class=nb>issubclass</span><span class=p>(</span><span class=n>field</span><span class=o>.</span><span class=n>type</span><span class=p>,</span> <span class=n>AmoraModel</span><span class=p>):</span>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a>                    <span class=k>yield</span> <span class=n>field</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>ARRAY</span><span class=p>(</span>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a>                        <span class=n>struct_for_model</span><span class=p>(</span><span class=n>field</span><span class=o>.</span><span class=n>metadata</span><span class=p>[</span><span class=n>SQLALCHEMY_METADATA_KEY</span><span class=p>]</span><span class=o>.</span><span class=n>type</span><span class=p>)</span>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a>                    <span class=p>)</span>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a>                <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a>                    <span class=k>yield</span> <span class=n>field</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>ARRAY</span><span class=p>(</span>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a>                        <span class=n>field</span><span class=o>.</span><span class=n>metadata</span><span class=p>[</span><span class=n>SQLALCHEMY_METADATA_KEY</span><span class=p>]</span><span class=o>.</span><span class=n>type</span>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>                    <span class=p>)</span>
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a>            <span class=k>elif</span> <span class=n>field</span><span class=o>.</span><span class=n>type</span> <span class=o>==</span> <span class=nb>dict</span><span class=p>:</span>
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a>                <span class=k>if</span> <span class=nb>issubclass</span><span class=p>(</span><span class=n>field</span><span class=o>.</span><span class=n>type</span><span class=p>,</span> <span class=n>AmoraModel</span><span class=p>):</span>
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a>                    <span class=k>yield</span> <span class=n>field</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>struct_for_model</span><span class=p>(</span>
<a id=__codelineno-0-22 name=__codelineno-0-22 href=#__codelineno-0-22></a>                        <span class=n>field</span><span class=o>.</span><span class=n>metadata</span><span class=p>[</span><span class=n>SQLALCHEMY_METADATA_KEY</span><span class=p>]</span><span class=o>.</span><span class=n>type</span>
<a id=__codelineno-0-23 name=__codelineno-0-23 href=#__codelineno-0-23></a>                    <span class=p>)</span>
<a id=__codelineno-0-24 name=__codelineno-0-24 href=#__codelineno-0-24></a>                <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-25 name=__codelineno-0-25 href=#__codelineno-0-25></a>                    <span class=k>yield</span> <span class=n>field</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>field</span><span class=o>.</span><span class=n>metadata</span><span class=p>[</span><span class=n>SQLALCHEMY_METADATA_KEY</span><span class=p>]</span><span class=o>.</span><span class=n>type</span>
<a id=__codelineno-0-26 name=__codelineno-0-26 href=#__codelineno-0-26></a>            <span class=k>else</span><span class=p>:</span>
<a id=__codelineno-0-27 name=__codelineno-0-27 href=#__codelineno-0-27></a>                <span class=k>yield</span> <span class=n>field</span><span class=o>.</span><span class=n>name</span><span class=p>,</span> <span class=n>field</span><span class=o>.</span><span class=n>metadata</span><span class=p>[</span><span class=n>SQLALCHEMY_METADATA_KEY</span><span class=p>]</span><span class=o>.</span><span class=n>type</span>
<a id=__codelineno-0-28 name=__codelineno-0-28 href=#__codelineno-0-28></a>
<a id=__codelineno-0-29 name=__codelineno-0-29 href=#__codelineno-0-29></a>    <span class=k>return</span> <span class=n>STRUCT</span><span class=p>(</span><span class=o>*</span><span class=n>fields</span><span class=p>())</span>
</code></pre></div> </details> </div> </div> <hr> <div class=md-source-file> <small> Last update: 2023-09-05 </small> </div> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../api/storage/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Storage" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Storage </div> </div> </a> <a href=../../tests/assertions/ class="md-footer__link md-footer__link--next" aria-label="Next: Data Assertions" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Data Assertions </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../assets/javascripts/bundle.d6c3db9e.min.js></script> </body> </html>